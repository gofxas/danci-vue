/*! *****************************************************************************
Copyright (c) Microsoft Corporation.
Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.
THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */
var e=function(){return e=Object.assign||function(e){for(var n,t=1,r=arguments.length;t<r;t++)for(var i in n=arguments[t])Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i]);return e},e.apply(this,arguments)};function n(e,n,t){if(t||2===arguments.length)for(var r,i=0,o=n.length;i<o;i++)!r&&i in n||(r||(r=Array.prototype.slice.call(n,0,i)),r[i]=n[i]);return e.concat(r||Array.prototype.slice.call(n))}var t="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:global,r=Object.keys,i=Array.isArray;function o(e,n){return"object"!=typeof n||r(n).forEach((function(t){e[t]=n[t]})),e}"undefined"==typeof Promise||t.Promise||(t.Promise=Promise);var a=Object.getPrototypeOf,u={}.hasOwnProperty;function s(e,n){return u.call(e,n)}function c(e,n){"function"==typeof n&&(n=n(a(e))),("undefined"==typeof Reflect?r:Reflect.ownKeys)(n).forEach((function(t){f(e,t,n[t])}))}var l=Object.defineProperty;function f(e,n,t,r){l(e,n,o(t&&s(t,"get")&&"function"==typeof t.get?{get:t.get,set:t.set,configurable:!0}:{value:t,configurable:!0,writable:!0},r))}function h(e){return{from:function(n){return e.prototype=Object.create(n.prototype),f(e.prototype,"constructor",e),{extend:c.bind(null,e.prototype)}}}}var d=Object.getOwnPropertyDescriptor;function p(e,n){var t;return d(e,n)||(t=a(e))&&p(t,n)}var y=[].slice;function v(e,n,t){return y.call(e,n,t)}function m(e,n){return n(e)}function g(e){if(!e)throw new Error("Assertion Failed")}function b(e){t.setImmediate?setImmediate(e):setTimeout(e,0)}function _(e,n){return e.reduce((function(e,t,r){var i=n(t,r);return i&&(e[i[0]]=i[1]),e}),{})}function w(e,n){if(s(e,n))return e[n];if(!n)return e;if("string"!=typeof n){for(var t=[],r=0,i=n.length;r<i;++r){var o=w(e,n[r]);t.push(o)}return t}var a=n.indexOf(".");if(-1!==a){var u=e[n.substr(0,a)];return void 0===u?void 0:w(u,n.substr(a+1))}}function x(e,n,t){if(e&&void 0!==n&&(!("isFrozen"in Object)||!Object.isFrozen(e)))if("string"!=typeof n&&"length"in n){g("string"!=typeof t&&"length"in t);for(var r=0,o=n.length;r<o;++r)x(e,n[r],t[r])}else{var a=n.indexOf(".");if(-1!==a){var u=n.substr(0,a),c=n.substr(a+1);if(""===c)void 0===t?i(e)&&!isNaN(parseInt(u))?e.splice(u,1):delete e[u]:e[u]=t;else{var l=e[u];l&&s(e,u)||(l=e[u]={}),x(l,c,t)}}else void 0===t?i(e)&&!isNaN(parseInt(n))?e.splice(n,1):delete e[n]:e[n]=t}}function k(e){var n={};for(var t in e)s(e,t)&&(n[t]=e[t]);return n}var E=[].concat;function P(e){return E.apply([],e)}var K="Boolean,String,Date,RegExp,Blob,File,FileList,FileSystemFileHandle,ArrayBuffer,DataView,Uint8ClampedArray,ImageBitmap,ImageData,Map,Set,CryptoKey".split(",").concat(P([8,16,32,64].map((function(e){return["Int","Uint","Float"].map((function(n){return n+e+"Array"}))})))).filter((function(e){return t[e]})),O=K.map((function(e){return t[e]}));_(K,(function(e){return[e,!0]}));var S=null;function A(e){S="undefined"!=typeof WeakMap&&new WeakMap;var n=C(e);return S=null,n}function C(e){if(!e||"object"!=typeof e)return e;var n=S&&S.get(e);if(n)return n;if(i(e)){n=[],S&&S.set(e,n);for(var t=0,r=e.length;t<r;++t)n.push(C(e[t]))}else if(O.indexOf(e.constructor)>=0)n=e;else{var o=a(e);for(var u in n=o===Object.prototype?{}:Object.create(o),S&&S.set(e,n),e)s(e,u)&&(n[u]=C(e[u]))}return n}var j={}.toString;function D(e){return j.call(e).slice(8,-1)}var I="undefined"!=typeof Symbol?Symbol.iterator:"@@iterator",B="symbol"==typeof I?function(e){var n;return null!=e&&(n=e[I])&&n.apply(e)}:function(){return null},T={};function R(e){var n,t,r,o;if(1===arguments.length){if(i(e))return e.slice();if(this===T&&"string"==typeof e)return[e];if(o=B(e)){for(t=[];!(r=o.next()).done;)t.push(r.value);return t}if(null==e)return[e];if("number"==typeof(n=e.length)){for(t=new Array(n);n--;)t[n]=e[n];return t}return[e]}for(n=arguments.length,t=new Array(n);n--;)t[n]=arguments[n];return t}var F="undefined"!=typeof Symbol?function(e){return"AsyncFunction"===e[Symbol.toStringTag]}:function(){return!1},M="undefined"!=typeof location&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function N(e,n){M=e,q=n}var q=function(){return!0},U=!new Error("").stack;function L(){if(U)try{throw L.arguments,new Error}catch(e){return e}return new Error}function V(e,n){var t=e.stack;return t?(n=n||0,0===t.indexOf(e.name)&&(n+=(e.name+e.message).split("\n").length),t.split("\n").slice(n).filter(q).map((function(e){return"\n"+e})).join("")):""}var W=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],Y=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"].concat(W),z={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed",MissingAPI:"IndexedDB API missing. Please visit https://tinyurl.com/y2uuvskb"};function G(e,n){this._e=L(),this.name=e,this.message=n}function H(e,n){return e+". Errors: "+Object.keys(n).map((function(e){return n[e].toString()})).filter((function(e,n,t){return t.indexOf(e)===n})).join("\n")}function Q(e,n,t,r){this._e=L(),this.failures=n,this.failedKeys=r,this.successCount=t,this.message=H(e,n)}function X(e,n){this._e=L(),this.name="BulkError",this.failures=Object.keys(n).map((function(e){return n[e]})),this.failuresByPos=n,this.message=H(e,n)}h(G).from(Error).extend({stack:{get:function(){return this._stack||(this._stack=this.name+": "+this.message+V(this._e,2))}},toString:function(){return this.name+": "+this.message}}),h(Q).from(G),h(X).from(G);var J=Y.reduce((function(e,n){return e[n]=n+"Error",e}),{}),$=G,Z=Y.reduce((function(e,n){var t=n+"Error";function r(e,r){this._e=L(),this.name=t,e?"string"==typeof e?(this.message=e+(r?"\n "+r:""),this.inner=r||null):"object"==typeof e&&(this.message=e.name+" "+e.message,this.inner=e):(this.message=z[n]||t,this.inner=null)}return h(r).from($),e[n]=r,e}),{});Z.Syntax=SyntaxError,Z.Type=TypeError,Z.Range=RangeError;var ee=W.reduce((function(e,n){return e[n+"Error"]=Z[n],e}),{});var ne=Y.reduce((function(e,n){return-1===["Syntax","Type","Range"].indexOf(n)&&(e[n+"Error"]=Z[n]),e}),{});function te(){}function re(e){return e}function ie(e,n){return null==e||e===re?n:function(t){return n(e(t))}}function oe(e,n){return function(){e.apply(this,arguments),n.apply(this,arguments)}}function ae(e,n){return e===te?n:function(){var t=e.apply(this,arguments);void 0!==t&&(arguments[0]=t);var r=this.onsuccess,i=this.onerror;this.onsuccess=null,this.onerror=null;var o=n.apply(this,arguments);return r&&(this.onsuccess=this.onsuccess?oe(r,this.onsuccess):r),i&&(this.onerror=this.onerror?oe(i,this.onerror):i),void 0!==o?o:t}}function ue(e,n){return e===te?n:function(){e.apply(this,arguments);var t=this.onsuccess,r=this.onerror;this.onsuccess=this.onerror=null,n.apply(this,arguments),t&&(this.onsuccess=this.onsuccess?oe(t,this.onsuccess):t),r&&(this.onerror=this.onerror?oe(r,this.onerror):r)}}function se(e,n){return e===te?n:function(t){var r=e.apply(this,arguments);o(t,r);var i=this.onsuccess,a=this.onerror;this.onsuccess=null,this.onerror=null;var u=n.apply(this,arguments);return i&&(this.onsuccess=this.onsuccess?oe(i,this.onsuccess):i),a&&(this.onerror=this.onerror?oe(a,this.onerror):a),void 0===r?void 0===u?void 0:u:o(r,u)}}function ce(e,n){return e===te?n:function(){return!1!==n.apply(this,arguments)&&e.apply(this,arguments)}}function le(e,n){return e===te?n:function(){var t=e.apply(this,arguments);if(t&&"function"==typeof t.then){for(var r=this,i=arguments.length,o=new Array(i);i--;)o[i]=arguments[i];return t.then((function(){return n.apply(r,o)}))}return n.apply(this,arguments)}}ne.ModifyError=Q,ne.DexieError=G,ne.BulkError=X;var fe={},he=100,de="undefined"==typeof Promise?[]:function(){var e=Promise.resolve();if("undefined"==typeof crypto||!crypto.subtle)return[e,a(e),e];var n=crypto.subtle.digest("SHA-512",new Uint8Array([0]));return[n,a(n),e]}(),pe=de[0],ye=de[1],ve=de[2],me=ye&&ye.then,ge=pe&&pe.constructor,be=!!ve,_e=!1,we=ve?function(){ve.then(We)}:t.setImmediate?setImmediate.bind(null,We):t.MutationObserver?function(){var e=document.createElement("div");new MutationObserver((function(){We(),e=null})).observe(e,{attributes:!0}),e.setAttribute("i","1")}:function(){setTimeout(We,0)},xe=function(e,n){je.push([e,n]),Ee&&(we(),Ee=!1)},ke=!0,Ee=!0,Pe=[],Ke=[],Oe=null,Se=re,Ae={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:vn,pgp:!1,env:{},finalize:function(){this.unhandleds.forEach((function(e){try{vn(e[0],e[1])}catch(n){}}))}},Ce=Ae,je=[],De=0,Ie=[];function Be(e){if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");this._listeners=[],this.onuncatched=te,this._lib=!1;var n=this._PSD=Ce;if(M&&(this._stackHolder=L(),this._prev=null,this._numPrev=0),"function"!=typeof e){if(e!==fe)throw new TypeError("Not a function");return this._state=arguments[1],this._value=arguments[2],void(!1===this._state&&Me(this,this._value))}this._state=null,this._value=null,++n.ref,Fe(this,e)}var Te={get:function(){var e=Ce,n=en;function t(t,r){var i=this,o=!e.global&&(e!==Ce||n!==en),a=o&&!on(),u=new Be((function(n,u){qe(i,new Re(dn(t,e,o,a),dn(r,e,o,a),n,u,e))}));return M&&Ve(u,this),u}return t.prototype=fe,t},set:function(e){f(this,"then",e&&e.prototype===fe?Te:{get:function(){return e},set:Te.set})}};function Re(e,n,t,r,i){this.onFulfilled="function"==typeof e?e:null,this.onRejected="function"==typeof n?n:null,this.resolve=t,this.reject=r,this.psd=i}function Fe(e,n){try{n((function(n){if(null===e._state){if(n===e)throw new TypeError("A promise cannot be resolved with itself.");var t=e._lib&&Ye();n&&"function"==typeof n.then?Fe(e,(function(e,t){n instanceof Be?n._then(e,t):n.then(e,t)})):(e._state=!0,e._value=n,Ne(e)),t&&ze()}}),Me.bind(null,e))}catch(t){Me(e,t)}}function Me(e,n){if(Ke.push(n),null===e._state){var t=e._lib&&Ye();n=Se(n),e._state=!1,e._value=n,M&&null!==n&&"object"==typeof n&&!n._promise&&function(e,n,t){try{e.apply(null,t)}catch(r){n&&n(r)}}((function(){var t=p(n,"stack");n._promise=e,f(n,"stack",{get:function(){return _e?t&&(t.get?t.get.apply(n):t.value):e.stack}})})),function(e){Pe.some((function(n){return n._value===e._value}))||Pe.push(e)}(e),Ne(e),t&&ze()}}function Ne(e){var n=e._listeners;e._listeners=[];for(var t=0,r=n.length;t<r;++t)qe(e,n[t]);var i=e._PSD;--i.ref||i.finalize(),0===De&&(++De,xe((function(){0==--De&&Ge()}),[]))}function qe(e,n){if(null!==e._state){var t=e._state?n.onFulfilled:n.onRejected;if(null===t)return(e._state?n.resolve:n.reject)(e._value);++n.psd.ref,++De,xe(Ue,[t,e,n])}else e._listeners.push(n)}function Ue(e,n,t){try{Oe=n;var r,i=n._value;n._state?r=e(i):(Ke.length&&(Ke=[]),r=e(i),-1===Ke.indexOf(i)&&function(e){var n=Pe.length;for(;n;)if(Pe[--n]._value===e._value)return void Pe.splice(n,1)}(n)),t.resolve(r)}catch(o){t.reject(o)}finally{Oe=null,0==--De&&Ge(),--t.psd.ref||t.psd.finalize()}}function Le(e,n,t){if(n.length===t)return n;var r="";if(!1===e._state){var i,o,a=e._value;null!=a?(i=a.name||"Error",o=a.message||a,r=V(a,0)):(i=a,o=""),n.push(i+(o?": "+o:"")+r)}return M&&((r=V(e._stackHolder,2))&&-1===n.indexOf(r)&&n.push(r),e._prev&&Le(e._prev,n,t)),n}function Ve(e,n){var t=n?n._numPrev+1:0;t<100&&(e._prev=n,e._numPrev=t)}function We(){Ye()&&ze()}function Ye(){var e=ke;return ke=!1,Ee=!1,e}function ze(){var e,n,t;do{for(;je.length>0;)for(e=je,je=[],t=e.length,n=0;n<t;++n){var r=e[n];r[0].apply(null,r[1])}}while(je.length>0);ke=!0,Ee=!0}function Ge(){var e=Pe;Pe=[],e.forEach((function(e){e._PSD.onunhandled.call(null,e._value,e)}));for(var n=Ie.slice(0),t=n.length;t;)n[--t]()}function He(e){return new Be(fe,!1,e)}function Qe(e,n){var t=Ce;return function(){var r=Ye(),i=Ce;try{return cn(t,!0),e.apply(this,arguments)}catch(o){n&&n(o)}finally{cn(i,!1),r&&ze()}}}c(Be.prototype,{then:Te,_then:function(e,n){qe(this,new Re(null,null,e,n,Ce))},catch:function(e){if(1===arguments.length)return this.then(null,e);var n=arguments[0],t=arguments[1];return"function"==typeof n?this.then(null,(function(e){return e instanceof n?t(e):He(e)})):this.then(null,(function(e){return e&&e.name===n?t(e):He(e)}))},finally:function(e){return this.then((function(n){return e(),n}),(function(n){return e(),He(n)}))},stack:{get:function(){if(this._stack)return this._stack;try{_e=!0;var e=Le(this,[],20).join("\nFrom previous: ");return null!==this._state&&(this._stack=e),e}finally{_e=!1}}},timeout:function(e,n){var t=this;return e<1/0?new Be((function(r,i){var o=setTimeout((function(){return i(new Z.Timeout(n))}),e);t.then(r,i).finally(clearTimeout.bind(null,o))})):this}}),"undefined"!=typeof Symbol&&Symbol.toStringTag&&f(Be.prototype,Symbol.toStringTag,"Dexie.Promise"),Ae.env=ln(),c(Be,{all:function(){var e=R.apply(null,arguments).map(an);return new Be((function(n,t){0===e.length&&n([]);var r=e.length;e.forEach((function(i,o){return Be.resolve(i).then((function(t){e[o]=t,--r||n(e)}),t)}))}))},resolve:function(e){if(e instanceof Be)return e;if(e&&"function"==typeof e.then)return new Be((function(n,t){e.then(n,t)}));var n=new Be(fe,!0,e);return Ve(n,Oe),n},reject:He,race:function(){var e=R.apply(null,arguments).map(an);return new Be((function(n,t){e.map((function(e){return Be.resolve(e).then(n,t)}))}))},PSD:{get:function(){return Ce},set:function(e){return Ce=e}},totalEchoes:{get:function(){return en}},newPSD:tn,usePSD:fn,scheduler:{get:function(){return xe},set:function(e){xe=e}},rejectionMapper:{get:function(){return Se},set:function(e){Se=e}},follow:function(e,n){return new Be((function(t,r){return tn((function(n,t){var r=Ce;r.unhandleds=[],r.onunhandled=t,r.finalize=oe((function(){var e=this;!function(e){function n(){e(),Ie.splice(Ie.indexOf(n),1)}Ie.push(n),++De,xe((function(){0==--De&&Ge()}),[])}((function(){0===e.unhandleds.length?n():t(e.unhandleds[0])}))}),r.finalize),e()}),n,t,r)}))}}),ge&&(ge.allSettled&&f(Be,"allSettled",(function(){var e=R.apply(null,arguments).map(an);return new Be((function(n){0===e.length&&n([]);var t=e.length,r=new Array(t);e.forEach((function(e,i){return Be.resolve(e).then((function(e){return r[i]={status:"fulfilled",value:e}}),(function(e){return r[i]={status:"rejected",reason:e}})).then((function(){return--t||n(r)}))}))}))})),ge.any&&"undefined"!=typeof AggregateError&&f(Be,"any",(function(){var e=R.apply(null,arguments).map(an);return new Be((function(n,t){0===e.length&&t(new AggregateError([]));var r=e.length,i=new Array(r);e.forEach((function(e,o){return Be.resolve(e).then((function(e){return n(e)}),(function(e){i[o]=e,--r||t(new AggregateError(i))}))}))}))})));var Xe={awaits:0,echoes:0,id:0},Je=0,$e=[],Ze=0,en=0,nn=0;function tn(e,n,t,r){var i=Ce,a=Object.create(i);a.parent=i,a.ref=0,a.global=!1,a.id=++nn;var u=Ae.env;a.env=be?{Promise:Be,PromiseProp:{value:Be,configurable:!0,writable:!0},all:Be.all,race:Be.race,allSettled:Be.allSettled,any:Be.any,resolve:Be.resolve,reject:Be.reject,nthen:pn(u.nthen,a),gthen:pn(u.gthen,a)}:{},n&&o(a,n),++i.ref,a.finalize=function(){--this.parent.ref||this.parent.finalize()};var s=fn(a,e,t,r);return 0===a.ref&&a.finalize(),s}function rn(){return Xe.id||(Xe.id=++Je),++Xe.awaits,Xe.echoes+=he,Xe.id}function on(){return!!Xe.awaits&&(0==--Xe.awaits&&(Xe.id=0),Xe.echoes=Xe.awaits*he,!0)}function an(e){return Xe.echoes&&e&&e.constructor===ge?(rn(),e.then((function(e){return on(),e}),(function(e){return on(),mn(e)}))):e}function un(e){++en,Xe.echoes&&0!=--Xe.echoes||(Xe.echoes=Xe.id=0),$e.push(Ce),cn(e,!0)}function sn(){var e=$e[$e.length-1];$e.pop(),cn(e,!1)}function cn(e,n){var r=Ce;if((n?!Xe.echoes||Ze++&&e===Ce:!Ze||--Ze&&e===Ce)||hn(n?un.bind(null,e):sn),e!==Ce&&(Ce=e,r===Ae&&(Ae.env=ln()),be)){var i=Ae.env.Promise,o=e.env;ye.then=o.nthen,i.prototype.then=o.gthen,(r.global||e.global)&&(Object.defineProperty(t,"Promise",o.PromiseProp),i.all=o.all,i.race=o.race,i.resolve=o.resolve,i.reject=o.reject,o.allSettled&&(i.allSettled=o.allSettled),o.any&&(i.any=o.any))}}function ln(){var e=t.Promise;return be?{Promise:e,PromiseProp:Object.getOwnPropertyDescriptor(t,"Promise"),all:e.all,race:e.race,allSettled:e.allSettled,any:e.any,resolve:e.resolve,reject:e.reject,nthen:ye.then,gthen:e.prototype.then}:{}}function fn(e,n,t,r,i){var o=Ce;try{return cn(e,!0),n(t,r,i)}finally{cn(o,!1)}}function hn(e){me.call(pe,e)}function dn(e,n,t,r){return"function"!=typeof e?e:function(){var i=Ce;t&&rn(),cn(n,!0);try{return e.apply(this,arguments)}finally{cn(i,!1),r&&hn(on)}}}function pn(e,n){return function(t,r){return e.call(this,dn(t,n),dn(r,n))}}-1===(""+me).indexOf("[native code]")&&(rn=on=te);var yn="unhandledrejection";function vn(e,n){var r;try{r=n.onuncatched(e)}catch(u){}if(!1!==r)try{var i,a={promise:n,reason:e};if(t.document&&document.createEvent?((i=document.createEvent("Event")).initEvent(yn,!0,!0),o(i,a)):t.CustomEvent&&o(i=new CustomEvent(yn,{detail:a}),a),i&&t.dispatchEvent&&(dispatchEvent(i),!t.PromiseRejectionEvent&&t.onunhandledrejection))try{t.onunhandledrejection(i)}catch(s){}M&&i&&!i.defaultPrevented&&console.warn("Unhandled rejection: "+(e.stack||e))}catch(u){}}var mn=Be.reject;function gn(e,n,t,r){if(e.idbdb&&(e._state.openComplete||Ce.letThrough||e._vip)){var i=e._createTransaction(n,t,e._dbSchema);try{i.create(),e._state.PR1398_maxLoop=3}catch(o){return o.name===J.InvalidState&&e.isOpen()&&--e._state.PR1398_maxLoop>0?(console.warn("Dexie: Need to reopen db"),e._close(),e.open().then((function(){return gn(e,n,t,r)}))):mn(o)}return i._promise(n,(function(e,n){return tn((function(){return Ce.trans=i,r(e,n,i)}))})).then((function(e){return i._completion.then((function(){return e}))}))}if(e._state.openComplete)return mn(new Z.DatabaseClosed(e._state.dbOpenError));if(!e._state.isBeingOpened){if(!e._options.autoOpen)return mn(new Z.DatabaseClosed);e.open().catch(te)}return e._state.dbReadyPromise.then((function(){return gn(e,n,t,r)}))}var bn="3.2.4",_n=String.fromCharCode(65535),wn=-1/0,xn="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",kn="String expected.",En=[],Pn="undefined"!=typeof navigator&&/(MSIE|Trident|Edge)/.test(navigator.userAgent),Kn=Pn,On=Pn,Sn=function(e){return!/(dexie\.js|dexie\.min\.js)/.test(e)},An="__dbnames",Cn="readonly",jn="readwrite";function Dn(e,n){return e?n?function(){return e.apply(this,arguments)&&n.apply(this,arguments)}:e:n}var In={type:3,lower:-1/0,lowerOpen:!1,upper:[[]],upperOpen:!1};function Bn(e){return"string"!=typeof e||/\./.test(e)?function(e){return e}:function(n){return void 0===n[e]&&e in n&&delete(n=A(n))[e],n}}var Tn=function(){function e(){}return e.prototype._trans=function(e,n,t){var r=this._tx||Ce.trans,i=this.name;function o(e,t,r){if(!r.schema[i])throw new Z.NotFound("Table "+i+" not part of transaction");return n(r.idbtrans,r)}var a=Ye();try{return r&&r.db===this.db?r===Ce.trans?r._promise(e,o,t):tn((function(){return r._promise(e,o,t)}),{trans:r,transless:Ce.transless||Ce}):gn(this.db,e,[this.name],o)}finally{a&&ze()}},e.prototype.get=function(e,n){var t=this;return e&&e.constructor===Object?this.where(e).first(n):this._trans("readonly",(function(n){return t.core.get({trans:n,key:e}).then((function(e){return t.hook.reading.fire(e)}))})).then(n)},e.prototype.where=function(e){if("string"==typeof e)return new this.db.WhereClause(this,e);if(i(e))return new this.db.WhereClause(this,"["+e.join("+")+"]");var n=r(e);if(1===n.length)return this.where(n[0]).equals(e[n[0]]);var t=this.schema.indexes.concat(this.schema.primKey).filter((function(e){return e.compound&&n.every((function(n){return e.keyPath.indexOf(n)>=0}))&&e.keyPath.every((function(e){return n.indexOf(e)>=0}))}))[0];if(t&&this.db._maxKey!==_n)return this.where(t.name).equals(t.keyPath.map((function(n){return e[n]})));!t&&M&&console.warn("The query "+JSON.stringify(e)+" on "+this.name+" would benefit of a compound index ["+n.join("+")+"]");var o=this.schema.idxByName,a=this.db._deps.indexedDB;function u(e,n){try{return 0===a.cmp(e,n)}catch(t){return!1}}var s=n.reduce((function(n,t){var r=n[0],a=n[1],s=o[t],c=e[t];return[r||s,r||!s?Dn(a,s&&s.multi?function(e){var n=w(e,t);return i(n)&&n.some((function(e){return u(c,e)}))}:function(e){return u(c,w(e,t))}):a]}),[null,null]),c=s[0],l=s[1];return c?this.where(c.name).equals(e[c.keyPath]).filter(l):t?this.filter(l):this.where(n).equals("")},e.prototype.filter=function(e){return this.toCollection().and(e)},e.prototype.count=function(e){return this.toCollection().count(e)},e.prototype.offset=function(e){return this.toCollection().offset(e)},e.prototype.limit=function(e){return this.toCollection().limit(e)},e.prototype.each=function(e){return this.toCollection().each(e)},e.prototype.toArray=function(e){return this.toCollection().toArray(e)},e.prototype.toCollection=function(){return new this.db.Collection(new this.db.WhereClause(this))},e.prototype.orderBy=function(e){return new this.db.Collection(new this.db.WhereClause(this,i(e)?"["+e.join("+")+"]":e))},e.prototype.reverse=function(){return this.toCollection().reverse()},e.prototype.mapToClass=function(e){this.schema.mappedClass=e;var n=function(n){if(!n)return n;var t=Object.create(e.prototype);for(var r in n)if(s(n,r))try{t[r]=n[r]}catch(i){}return t};return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=n,this.hook("reading",n),e},e.prototype.defineClass=function(){return this.mapToClass((function(e){o(this,e)}))},e.prototype.add=function(e,n){var t=this,r=this.schema.primKey,i=r.auto,o=r.keyPath,a=e;return o&&i&&(a=Bn(o)(e)),this._trans("readwrite",(function(e){return t.core.mutate({trans:e,type:"add",keys:null!=n?[n]:null,values:[a]})})).then((function(e){return e.numFailures?Be.reject(e.failures[0]):e.lastResult})).then((function(n){if(o)try{x(e,o,n)}catch(t){}return n}))},e.prototype.update=function(e,n){if("object"!=typeof e||i(e))return this.where(":id").equals(e).modify(n);var t=w(e,this.schema.primKey.keyPath);if(void 0===t)return mn(new Z.InvalidArgument("Given object does not contain its primary key"));try{"function"!=typeof n?r(n).forEach((function(t){x(e,t,n[t])})):n(e,{value:e,primKey:t})}catch(o){}return this.where(":id").equals(t).modify(n)},e.prototype.put=function(e,n){var t=this,r=this.schema.primKey,i=r.auto,o=r.keyPath,a=e;return o&&i&&(a=Bn(o)(e)),this._trans("readwrite",(function(e){return t.core.mutate({trans:e,type:"put",values:[a],keys:null!=n?[n]:null})})).then((function(e){return e.numFailures?Be.reject(e.failures[0]):e.lastResult})).then((function(n){if(o)try{x(e,o,n)}catch(t){}return n}))},e.prototype.delete=function(e){var n=this;return this._trans("readwrite",(function(t){return n.core.mutate({trans:t,type:"delete",keys:[e]})})).then((function(e){return e.numFailures?Be.reject(e.failures[0]):void 0}))},e.prototype.clear=function(){var e=this;return this._trans("readwrite",(function(n){return e.core.mutate({trans:n,type:"deleteRange",range:In})})).then((function(e){return e.numFailures?Be.reject(e.failures[0]):void 0}))},e.prototype.bulkGet=function(e){var n=this;return this._trans("readonly",(function(t){return n.core.getMany({keys:e,trans:t}).then((function(e){return e.map((function(e){return n.hook.reading.fire(e)}))}))}))},e.prototype.bulkAdd=function(e,n,t){var r=this,i=Array.isArray(n)?n:void 0,o=(t=t||(i?void 0:n))?t.allKeys:void 0;return this._trans("readwrite",(function(n){var t=r.schema.primKey,a=t.auto,u=t.keyPath;if(u&&i)throw new Z.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(i&&i.length!==e.length)throw new Z.InvalidArgument("Arguments objects and keys must have the same length");var s=e.length,c=u&&a?e.map(Bn(u)):e;return r.core.mutate({trans:n,type:"add",keys:i,values:c,wantResults:o}).then((function(e){var n=e.numFailures,t=e.results,i=e.lastResult,a=e.failures;if(0===n)return o?t:i;throw new X(r.name+".bulkAdd(): "+n+" of "+s+" operations failed",a)}))}))},e.prototype.bulkPut=function(e,n,t){var r=this,i=Array.isArray(n)?n:void 0,o=(t=t||(i?void 0:n))?t.allKeys:void 0;return this._trans("readwrite",(function(n){var t=r.schema.primKey,a=t.auto,u=t.keyPath;if(u&&i)throw new Z.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(i&&i.length!==e.length)throw new Z.InvalidArgument("Arguments objects and keys must have the same length");var s=e.length,c=u&&a?e.map(Bn(u)):e;return r.core.mutate({trans:n,type:"put",keys:i,values:c,wantResults:o}).then((function(e){var n=e.numFailures,t=e.results,i=e.lastResult,a=e.failures;if(0===n)return o?t:i;throw new X(r.name+".bulkPut(): "+n+" of "+s+" operations failed",a)}))}))},e.prototype.bulkDelete=function(e){var n=this,t=e.length;return this._trans("readwrite",(function(t){return n.core.mutate({trans:t,type:"delete",keys:e})})).then((function(e){var r=e.numFailures,i=e.lastResult,o=e.failures;if(0===r)return i;throw new X(n.name+".bulkDelete(): "+r+" of "+t+" operations failed",o)}))},e}();function Rn(e){var n={},t=function(t,r){if(r){for(var i=arguments.length,o=new Array(i-1);--i;)o[i-1]=arguments[i];return n[t].subscribe.apply(null,o),e}if("string"==typeof t)return n[t]};t.addEventType=u;for(var o=1,a=arguments.length;o<a;++o)u(arguments[o]);return t;function u(e,o,a){if("object"!=typeof e){var s;o||(o=ce),a||(a=te);var c={subscribers:[],fire:a,subscribe:function(e){-1===c.subscribers.indexOf(e)&&(c.subscribers.push(e),c.fire=o(c.fire,e))},unsubscribe:function(e){c.subscribers=c.subscribers.filter((function(n){return n!==e})),c.fire=c.subscribers.reduce(o,a)}};return n[e]=t[e]=c,c}r(s=e).forEach((function(e){var n=s[e];if(i(n))u(e,s[e][0],s[e][1]);else{if("asap"!==n)throw new Z.InvalidArgument("Invalid event config");var t=u(e,re,(function(){for(var e=arguments.length,n=new Array(e);e--;)n[e]=arguments[e];t.subscribers.forEach((function(e){b((function(){e.apply(null,n)}))}))}))}}))}}function Fn(e,n){return h(n).from({prototype:e}),n}function Mn(e,n){return!(e.filter||e.algorithm||e.or)&&(n?e.justLimit:!e.replayFilter)}function Nn(e,n){e.filter=Dn(e.filter,n)}function qn(e,n,t){var r=e.replayFilter;e.replayFilter=r?function(){return Dn(r(),n())}:n,e.justLimit=t&&!r}function Un(e,n){if(e.isPrimKey)return n.primaryKey;var t=n.getIndexByKeyPath(e.index);if(!t)throw new Z.Schema("KeyPath "+e.index+" on object store "+n.name+" is not indexed");return t}function Ln(e,n,t){var r=Un(e,n.schema);return n.openCursor({trans:t,values:!e.keysOnly,reverse:"prev"===e.dir,unique:!!e.unique,query:{index:r,range:e.range}})}function Vn(e,n,t,r){var i=e.replayFilter?Dn(e.filter,e.replayFilter()):e.filter;if(e.or){var o={},a=function(e,t,r){if(!i||i(t,r,(function(e){return t.stop(e)}),(function(e){return t.fail(e)}))){var a=t.primaryKey,u=""+a;"[object ArrayBuffer]"===u&&(u=""+new Uint8Array(a)),s(o,u)||(o[u]=!0,n(e,t,r))}};return Promise.all([e.or._iterate(a,t),Wn(Ln(e,r,t),e.algorithm,a,!e.keysOnly&&e.valueMapper)])}return Wn(Ln(e,r,t),Dn(e.algorithm,i),n,!e.keysOnly&&e.valueMapper)}function Wn(e,n,t,r){var i=Qe(r?function(e,n,i){return t(r(e),n,i)}:t);return e.then((function(e){if(e)return e.start((function(){var t=function(){return e.continue()};n&&!n(e,(function(e){return t=e}),(function(n){e.stop(n),t=te}),(function(n){e.fail(n),t=te}))||i(e.value,e,(function(e){return t=e})),t()}))}))}function Yn(e,n){try{var t=zn(e),r=zn(n);if(t!==r)return"Array"===t?1:"Array"===r?-1:"binary"===t?1:"binary"===r?-1:"string"===t?1:"string"===r?-1:"Date"===t?1:"Date"!==r?NaN:-1;switch(t){case"number":case"Date":case"string":return e>n?1:e<n?-1:0;case"binary":return function(e,n){for(var t=e.length,r=n.length,i=t<r?t:r,o=0;o<i;++o)if(e[o]!==n[o])return e[o]<n[o]?-1:1;return t===r?0:t<r?-1:1}(Gn(e),Gn(n));case"Array":return function(e,n){for(var t=e.length,r=n.length,i=t<r?t:r,o=0;o<i;++o){var a=Yn(e[o],n[o]);if(0!==a)return a}return t===r?0:t<r?-1:1}(e,n)}}catch(i){}return NaN}function zn(e){var n=typeof e;if("object"!==n)return n;if(ArrayBuffer.isView(e))return"binary";var t=D(e);return"ArrayBuffer"===t?"binary":t}function Gn(e){return e instanceof Uint8Array?e:ArrayBuffer.isView(e)?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):new Uint8Array(e)}var Hn=function(){function e(){}return e.prototype._read=function(e,n){var t=this._ctx;return t.error?t.table._trans(null,mn.bind(null,t.error)):t.table._trans("readonly",e).then(n)},e.prototype._write=function(e){var n=this._ctx;return n.error?n.table._trans(null,mn.bind(null,n.error)):n.table._trans("readwrite",e,"locked")},e.prototype._addAlgorithm=function(e){var n=this._ctx;n.algorithm=Dn(n.algorithm,e)},e.prototype._iterate=function(e,n){return Vn(this._ctx,e,n,this._ctx.table.core)},e.prototype.clone=function(e){var n=Object.create(this.constructor.prototype),t=Object.create(this._ctx);return e&&o(t,e),n._ctx=t,n},e.prototype.raw=function(){return this._ctx.valueMapper=null,this},e.prototype.each=function(e){var n=this._ctx;return this._read((function(t){return Vn(n,e,t,n.table.core)}))},e.prototype.count=function(e){var n=this;return this._read((function(e){var t=n._ctx,r=t.table.core;if(Mn(t,!0))return r.count({trans:e,query:{index:Un(t,r.schema),range:t.range}}).then((function(e){return Math.min(e,t.limit)}));var i=0;return Vn(t,(function(){return++i,!1}),e,r).then((function(){return i}))})).then(e)},e.prototype.sortBy=function(e,n){var t=e.split(".").reverse(),r=t[0],i=t.length-1;function o(e,n){return n?o(e[t[n]],n-1):e[r]}var a="next"===this._ctx.dir?1:-1;function u(e,n){var t=o(e,i),r=o(n,i);return t<r?-a:t>r?a:0}return this.toArray((function(e){return e.sort(u)})).then(n)},e.prototype.toArray=function(e){var n=this;return this._read((function(e){var t=n._ctx;if("next"===t.dir&&Mn(t,!0)&&t.limit>0){var r=t.valueMapper,i=Un(t,t.table.core.schema);return t.table.core.query({trans:e,limit:t.limit,values:!0,query:{index:i,range:t.range}}).then((function(e){var n=e.result;return r?n.map(r):n}))}var o=[];return Vn(t,(function(e){return o.push(e)}),e,t.table.core).then((function(){return o}))}),e)},e.prototype.offset=function(e){var n=this._ctx;return e<=0||(n.offset+=e,Mn(n)?qn(n,(function(){var n=e;return function(e,t){return 0===n||(1===n?(--n,!1):(t((function(){e.advance(n),n=0})),!1))}})):qn(n,(function(){var n=e;return function(){return--n<0}}))),this},e.prototype.limit=function(e){return this._ctx.limit=Math.min(this._ctx.limit,e),qn(this._ctx,(function(){var n=e;return function(e,t,r){return--n<=0&&t(r),n>=0}}),!0),this},e.prototype.until=function(e,n){return Nn(this._ctx,(function(t,r,i){return!e(t.value)||(r(i),n)})),this},e.prototype.first=function(e){return this.limit(1).toArray((function(e){return e[0]})).then(e)},e.prototype.last=function(e){return this.reverse().first(e)},e.prototype.filter=function(e){var n,t;return Nn(this._ctx,(function(n){return e(n.value)})),n=this._ctx,t=e,n.isMatch=Dn(n.isMatch,t),this},e.prototype.and=function(e){return this.filter(e)},e.prototype.or=function(e){return new this.db.WhereClause(this._ctx.table,e,this)},e.prototype.reverse=function(){return this._ctx.dir="prev"===this._ctx.dir?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this},e.prototype.desc=function(){return this.reverse()},e.prototype.eachKey=function(e){var n=this._ctx;return n.keysOnly=!n.isMatch,this.each((function(n,t){e(t.key,t)}))},e.prototype.eachUniqueKey=function(e){return this._ctx.unique="unique",this.eachKey(e)},e.prototype.eachPrimaryKey=function(e){var n=this._ctx;return n.keysOnly=!n.isMatch,this.each((function(n,t){e(t.primaryKey,t)}))},e.prototype.keys=function(e){var n=this._ctx;n.keysOnly=!n.isMatch;var t=[];return this.each((function(e,n){t.push(n.key)})).then((function(){return t})).then(e)},e.prototype.primaryKeys=function(e){var n=this._ctx;if("next"===n.dir&&Mn(n,!0)&&n.limit>0)return this._read((function(e){var t=Un(n,n.table.core.schema);return n.table.core.query({trans:e,values:!1,limit:n.limit,query:{index:t,range:n.range}})})).then((function(e){return e.result})).then(e);n.keysOnly=!n.isMatch;var t=[];return this.each((function(e,n){t.push(n.primaryKey)})).then((function(){return t})).then(e)},e.prototype.uniqueKeys=function(e){return this._ctx.unique="unique",this.keys(e)},e.prototype.firstKey=function(e){return this.limit(1).keys((function(e){return e[0]})).then(e)},e.prototype.lastKey=function(e){return this.reverse().firstKey(e)},e.prototype.distinct=function(){var e=this._ctx,n=e.index&&e.table.schema.idxByName[e.index];if(!n||!n.multi)return this;var t={};return Nn(this._ctx,(function(e){var n=e.primaryKey.toString(),r=s(t,n);return t[n]=!0,!r})),this},e.prototype.modify=function(e){var n=this,t=this._ctx;return this._write((function(i){var o;if("function"==typeof e)o=e;else{var a=r(e),u=a.length;o=function(n){for(var t=!1,r=0;r<u;++r){var i=a[r],o=e[i];w(n,i)!==o&&(x(n,i,o),t=!0)}return t}}var s=t.table.core,c=s.schema.primaryKey,l=c.outbound,f=c.extractKey,h=n.db._options.modifyChunkSize||200,d=[],p=0,y=[],v=function(e,n){var t=n.failures,i=n.numFailures;p+=e-i;for(var o=0,a=r(t);o<a.length;o++){var u=a[o];d.push(t[u])}};return n.clone().primaryKeys().then((function(n){var r=function(a){var u=Math.min(h,n.length-a);return s.getMany({trans:i,keys:n.slice(a,a+u),cache:"immutable"}).then((function(c){for(var d=[],p=[],y=l?[]:null,m=[],g=0;g<u;++g){var b=c[g],_={value:A(b),primKey:n[a+g]};!1!==o.call(_,_.value,_)&&(null==_.value?m.push(n[a+g]):l||0===Yn(f(b),f(_.value))?(p.push(_.value),l&&y.push(n[a+g])):(m.push(n[a+g]),d.push(_.value)))}var w=Mn(t)&&t.limit===1/0&&("function"!=typeof e||e===Qn)&&{index:t.index,range:t.range};return Promise.resolve(d.length>0&&s.mutate({trans:i,type:"add",values:d}).then((function(e){for(var n in e.failures)m.splice(parseInt(n),1);v(d.length,e)}))).then((function(){return(p.length>0||w&&"object"==typeof e)&&s.mutate({trans:i,type:"put",keys:y,values:p,criteria:w,changeSpec:"function"!=typeof e&&e}).then((function(e){return v(p.length,e)}))})).then((function(){return(m.length>0||w&&e===Qn)&&s.mutate({trans:i,type:"delete",keys:m,criteria:w}).then((function(e){return v(m.length,e)}))})).then((function(){return n.length>a+u&&r(a+h)}))}))};return r(0).then((function(){if(d.length>0)throw new Q("Error modifying one or more objects",d,p,y);return n.length}))}))}))},e.prototype.delete=function(){var e=this._ctx,n=e.range;return Mn(e)&&(e.isPrimKey&&!On||3===n.type)?this._write((function(t){var r=e.table.core.schema.primaryKey,i=n;return e.table.core.count({trans:t,query:{index:r,range:i}}).then((function(n){return e.table.core.mutate({trans:t,type:"deleteRange",range:i}).then((function(e){var t=e.failures;e.lastResult,e.results;var r=e.numFailures;if(r)throw new Q("Could not delete some values",Object.keys(t).map((function(e){return t[e]})),n-r);return n-r}))}))})):this.modify(Qn)},e}(),Qn=function(e,n){return n.value=null};function Xn(e,n){return e<n?-1:e===n?0:1}function Jn(e,n){return e>n?-1:e===n?0:1}function $n(e,n,t){var r=e instanceof it?new e.Collection(e):e;return r._ctx.error=t?new t(n):new TypeError(n),r}function Zn(e){return new e.Collection(e,(function(){return rt("")})).limit(0)}function et(e,n,t,r,i,o){for(var a=Math.min(e.length,r.length),u=-1,s=0;s<a;++s){var c=n[s];if(c!==r[s])return i(e[s],t[s])<0?e.substr(0,s)+t[s]+t.substr(s+1):i(e[s],r[s])<0?e.substr(0,s)+r[s]+t.substr(s+1):u>=0?e.substr(0,u)+n[u]+t.substr(u+1):null;i(e[s],c)<0&&(u=s)}return a<r.length&&"next"===o?e+t.substr(e.length):a<e.length&&"prev"===o?e.substr(0,t.length):u<0?null:e.substr(0,u)+r[u]+t.substr(u+1)}function nt(e,n,t,r){var i,o,a,u,s,c,l,f=t.length;if(!t.every((function(e){return"string"==typeof e})))return $n(e,kn);function h(e){i=function(e){return"next"===e?function(e){return e.toUpperCase()}:function(e){return e.toLowerCase()}}(e),o=function(e){return"next"===e?function(e){return e.toLowerCase()}:function(e){return e.toUpperCase()}}(e),a="next"===e?Xn:Jn;var n=t.map((function(e){return{lower:o(e),upper:i(e)}})).sort((function(e,n){return a(e.lower,n.lower)}));u=n.map((function(e){return e.upper})),s=n.map((function(e){return e.lower})),c=e,l="next"===e?"":r}h("next");var d=new e.Collection(e,(function(){return tt(u[0],s[f-1]+r)}));d._ondirectionchange=function(e){h(e)};var p=0;return d._addAlgorithm((function(e,t,r){var i=e.key;if("string"!=typeof i)return!1;var h=o(i);if(n(h,s,p))return!0;for(var d=null,y=p;y<f;++y){var v=et(i,h,u[y],s[y],a,c);null===v&&null===d?p=y+1:(null===d||a(d,v)>0)&&(d=v)}return t(null!==d?function(){e.continue(d+l)}:r),!1})),d}function tt(e,n,t,r){return{type:2,lower:e,upper:n,lowerOpen:t,upperOpen:r}}function rt(e){return{type:1,lower:e,upper:e}}var it=function(){function e(){}return Object.defineProperty(e.prototype,"Collection",{get:function(){return this._ctx.table.db.Collection},enumerable:!1,configurable:!0}),e.prototype.between=function(e,n,t,r){t=!1!==t,r=!0===r;try{return this._cmp(e,n)>0||0===this._cmp(e,n)&&(t||r)&&(!t||!r)?Zn(this):new this.Collection(this,(function(){return tt(e,n,!t,!r)}))}catch(i){return $n(this,xn)}},e.prototype.equals=function(e){return null==e?$n(this,xn):new this.Collection(this,(function(){return rt(e)}))},e.prototype.above=function(e){return null==e?$n(this,xn):new this.Collection(this,(function(){return tt(e,void 0,!0)}))},e.prototype.aboveOrEqual=function(e){return null==e?$n(this,xn):new this.Collection(this,(function(){return tt(e,void 0,!1)}))},e.prototype.below=function(e){return null==e?$n(this,xn):new this.Collection(this,(function(){return tt(void 0,e,!1,!0)}))},e.prototype.belowOrEqual=function(e){return null==e?$n(this,xn):new this.Collection(this,(function(){return tt(void 0,e)}))},e.prototype.startsWith=function(e){return"string"!=typeof e?$n(this,kn):this.between(e,e+_n,!0,!0)},e.prototype.startsWithIgnoreCase=function(e){return""===e?this.startsWith(e):nt(this,(function(e,n){return 0===e.indexOf(n[0])}),[e],_n)},e.prototype.equalsIgnoreCase=function(e){return nt(this,(function(e,n){return e===n[0]}),[e],"")},e.prototype.anyOfIgnoreCase=function(){var e=R.apply(T,arguments);return 0===e.length?Zn(this):nt(this,(function(e,n){return-1!==n.indexOf(e)}),e,"")},e.prototype.startsWithAnyOfIgnoreCase=function(){var e=R.apply(T,arguments);return 0===e.length?Zn(this):nt(this,(function(e,n){return n.some((function(n){return 0===e.indexOf(n)}))}),e,_n)},e.prototype.anyOf=function(){var e=this,n=R.apply(T,arguments),t=this._cmp;try{n.sort(t)}catch(o){return $n(this,xn)}if(0===n.length)return Zn(this);var r=new this.Collection(this,(function(){return tt(n[0],n[n.length-1])}));r._ondirectionchange=function(r){t="next"===r?e._ascending:e._descending,n.sort(t)};var i=0;return r._addAlgorithm((function(e,r,o){for(var a=e.key;t(a,n[i])>0;)if(++i===n.length)return r(o),!1;return 0===t(a,n[i])||(r((function(){e.continue(n[i])})),!1)})),r},e.prototype.notEqual=function(e){return this.inAnyRange([[wn,e],[e,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})},e.prototype.noneOf=function(){var e=R.apply(T,arguments);if(0===e.length)return new this.Collection(this);try{e.sort(this._ascending)}catch(t){return $n(this,xn)}var n=e.reduce((function(e,n){return e?e.concat([[e[e.length-1][1],n]]):[[wn,n]]}),null);return n.push([e[e.length-1],this.db._maxKey]),this.inAnyRange(n,{includeLowers:!1,includeUppers:!1})},e.prototype.inAnyRange=function(e,n){var t=this,r=this._cmp,i=this._ascending,o=this._descending,a=this._min,u=this._max;if(0===e.length)return Zn(this);if(!e.every((function(e){return void 0!==e[0]&&void 0!==e[1]&&i(e[0],e[1])<=0})))return $n(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",Z.InvalidArgument);var s=!n||!1!==n.includeLowers,c=n&&!0===n.includeUppers;var l,f=i;function h(e,n){return f(e[0],n[0])}try{(l=e.reduce((function(e,n){for(var t=0,i=e.length;t<i;++t){var o=e[t];if(r(n[0],o[1])<0&&r(n[1],o[0])>0){o[0]=a(o[0],n[0]),o[1]=u(o[1],n[1]);break}}return t===i&&e.push(n),e}),[])).sort(h)}catch(g){return $n(this,xn)}var d=0,p=c?function(e){return i(e,l[d][1])>0}:function(e){return i(e,l[d][1])>=0},y=s?function(e){return o(e,l[d][0])>0}:function(e){return o(e,l[d][0])>=0};var v=p,m=new this.Collection(this,(function(){return tt(l[0][0],l[l.length-1][1],!s,!c)}));return m._ondirectionchange=function(e){"next"===e?(v=p,f=i):(v=y,f=o),l.sort(h)},m._addAlgorithm((function(e,n,r){for(var o=e.key;v(o);)if(++d===l.length)return n(r),!1;return!!function(e){return!p(e)&&!y(e)}(o)||(0===t._cmp(o,l[d][1])||0===t._cmp(o,l[d][0])||n((function(){f===i?e.continue(l[d][0]):e.continue(l[d][1])})),!1)})),m},e.prototype.startsWithAnyOf=function(){var e=R.apply(T,arguments);return e.every((function(e){return"string"==typeof e}))?0===e.length?Zn(this):this.inAnyRange(e.map((function(e){return[e,e+_n]}))):$n(this,"startsWithAnyOf() only works with strings")},e}();function ot(e){return Qe((function(n){return at(n),e(n.target.error),!1}))}function at(e){e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault()}var ut="storagemutated",st="x-storagemutated-1",ct=Rn(null,ut),lt=function(){function e(){}return e.prototype._lock=function(){return g(!Ce.global),++this._reculock,1!==this._reculock||Ce.global||(Ce.lockOwnerFor=this),this},e.prototype._unlock=function(){if(g(!Ce.global),0==--this._reculock)for(Ce.global||(Ce.lockOwnerFor=null);this._blockedFuncs.length>0&&!this._locked();){var e=this._blockedFuncs.shift();try{fn(e[1],e[0])}catch(n){}}return this},e.prototype._locked=function(){return this._reculock&&Ce.lockOwnerFor!==this},e.prototype.create=function(e){var n=this;if(!this.mode)return this;var t=this.db.idbdb,r=this.db._state.dbOpenError;if(g(!this.idbtrans),!e&&!t)switch(r&&r.name){case"DatabaseClosedError":throw new Z.DatabaseClosed(r);case"MissingAPIError":throw new Z.MissingAPI(r.message,r);default:throw new Z.OpenFailed(r)}if(!this.active)throw new Z.TransactionInactive;return g(null===this._completion._state),(e=this.idbtrans=e||(this.db.core?this.db.core.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability}):t.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability}))).onerror=Qe((function(t){at(t),n._reject(e.error)})),e.onabort=Qe((function(t){at(t),n.active&&n._reject(new Z.Abort(e.error)),n.active=!1,n.on("abort").fire(t)})),e.oncomplete=Qe((function(){n.active=!1,n._resolve(),"mutatedParts"in e&&ct.storagemutated.fire(e.mutatedParts)})),this},e.prototype._promise=function(e,n,t){var r=this;if("readwrite"===e&&"readwrite"!==this.mode)return mn(new Z.ReadOnly("Transaction is readonly"));if(!this.active)return mn(new Z.TransactionInactive);if(this._locked())return new Be((function(i,o){r._blockedFuncs.push([function(){r._promise(e,n,t).then(i,o)},Ce])}));if(t)return tn((function(){var e=new Be((function(e,t){r._lock();var i=n(e,t,r);i&&i.then&&i.then(e,t)}));return e.finally((function(){return r._unlock()})),e._lib=!0,e}));var i=new Be((function(e,t){var i=n(e,t,r);i&&i.then&&i.then(e,t)}));return i._lib=!0,i},e.prototype._root=function(){return this.parent?this.parent._root():this},e.prototype.waitFor=function(e){var n=this._root(),t=Be.resolve(e);if(n._waitingFor)n._waitingFor=n._waitingFor.then((function(){return t}));else{n._waitingFor=t,n._waitingQueue=[];var r=n.idbtrans.objectStore(n.storeNames[0]);!function e(){for(++n._spinCount;n._waitingQueue.length;)n._waitingQueue.shift()();n._waitingFor&&(r.get(-1/0).onsuccess=e)}()}var i=n._waitingFor;return new Be((function(e,r){t.then((function(t){return n._waitingQueue.push(Qe(e.bind(null,t)))}),(function(e){return n._waitingQueue.push(Qe(r.bind(null,e)))})).finally((function(){n._waitingFor===i&&(n._waitingFor=null)}))}))},e.prototype.abort=function(){this.active&&(this.active=!1,this.idbtrans&&this.idbtrans.abort(),this._reject(new Z.Abort))},e.prototype.table=function(e){var n=this._memoizedTables||(this._memoizedTables={});if(s(n,e))return n[e];var t=this.schema[e];if(!t)throw new Z.NotFound("Table "+e+" not part of transaction");var r=new this.db.Table(e,t,this);return r.core=this.db.core.table(e),n[e]=r,r},e}();function ft(e,n,t,r,i,o,a){return{name:e,keyPath:n,unique:t,multi:r,auto:i,compound:o,src:(t&&!a?"&":"")+(r?"*":"")+(i?"++":"")+ht(n)}}function ht(e){return"string"==typeof e?e:e?"["+[].join.call(e,"+")+"]":""}function dt(e,n,t){return{name:e,primKey:n,indexes:t,mappedClass:null,idxByName:_(t,(function(e){return[e.name,e]}))}}var pt=function(e){try{return e.only([[]]),pt=function(){return[[]]},[[]]}catch(n){return pt=function(){return _n},_n}};function yt(e){return null==e?function(){}:"string"==typeof e?function(e){var n=e.split(".");return 1===n.length?function(n){return n[e]}:function(n){return w(n,e)}}(e):function(n){return w(n,e)}}function vt(e){return[].slice.call(e)}var mt=0;function gt(e){return null==e?":id":"string"==typeof e?e:"["+e.join("+")+"]"}function bt(e,n,t){function r(e){if(3===e.type)return null;if(4===e.type)throw new Error("Cannot convert never type to IDBKeyRange");var t=e.lower,r=e.upper,i=e.lowerOpen,o=e.upperOpen;return void 0===t?void 0===r?null:n.upperBound(r,!!o):void 0===r?n.lowerBound(t,!!i):n.bound(t,r,!!i,!!o)}var o,a,u,s=(a=t,u=vt((o=e).objectStoreNames),{schema:{name:o.name,tables:u.map((function(e){return a.objectStore(e)})).map((function(e){var n=e.keyPath,t=e.autoIncrement,r=i(n),o=null==n,a={},u={name:e.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:o,compound:r,keyPath:n,autoIncrement:t,unique:!0,extractKey:yt(n)},indexes:vt(e.indexNames).map((function(n){return e.index(n)})).map((function(e){var n=e.name,t=e.unique,r=e.multiEntry,o=e.keyPath,u={name:n,compound:i(o),keyPath:o,unique:t,multiEntry:r,extractKey:yt(o)};return a[gt(o)]=u,u})),getIndexByKeyPath:function(e){return a[gt(e)]}};return a[":id"]=u.primaryKey,null!=n&&(a[gt(n)]=u.primaryKey),u}))},hasGetAll:u.length>0&&"getAll"in a.objectStore(u[0])&&!("undefined"!=typeof navigator&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)}),c=s.schema,l=s.hasGetAll,f=c.tables.map((function(e){return function(e){var n,t=e.name;return{name:t,schema:e,mutate:function(e){var n=e.trans,i=e.type,o=e.keys,a=e.values,u=e.range;return new Promise((function(e,s){e=Qe(e);var c=n.objectStore(t),l=null==c.keyPath,f="put"===i||"add"===i;if(!f&&"delete"!==i&&"deleteRange"!==i)throw new Error("Invalid operation type: "+i);var h,d=(o||a||{length:1}).length;if(o&&a&&o.length!==a.length)throw new Error("Given keys array must have same length as given values array.");if(0===d)return e({numFailures:0,failures:{},results:[],lastResult:void 0});var p=[],y=[],v=0,m=function(e){++v,at(e)};if("deleteRange"===i){if(4===u.type)return e({numFailures:v,failures:y,results:[],lastResult:void 0});3===u.type?p.push(h=c.clear()):p.push(h=c.delete(r(u)))}else{var g=f?l?[a,o]:[a,null]:[o,null],b=g[0],_=g[1];if(f)for(var w=0;w<d;++w)p.push(h=_&&void 0!==_[w]?c[i](b[w],_[w]):c[i](b[w])),h.onerror=m;else for(w=0;w<d;++w)p.push(h=c[i](b[w])),h.onerror=m}var x=function(n){var t=n.target.result;p.forEach((function(e,n){return null!=e.error&&(y[n]=e.error)})),e({numFailures:v,failures:y,results:"delete"===i?o:p.map((function(e){return e.result})),lastResult:t})};h.onerror=function(e){m(e),x(e)},h.onsuccess=x}))},getMany:function(e){var n=e.trans,r=e.keys;return new Promise((function(e,i){e=Qe(e);for(var o,a=n.objectStore(t),u=r.length,s=new Array(u),c=0,l=0,f=function(n){var t=n.target;s[t._pos]=t.result,++l===c&&e(s)},h=ot(i),d=0;d<u;++d)null!=r[d]&&((o=a.get(r[d]))._pos=d,o.onsuccess=f,o.onerror=h,++c);0===c&&e(s)}))},get:function(e){var n=e.trans,r=e.key;return new Promise((function(e,i){e=Qe(e);var o=n.objectStore(t).get(r);o.onsuccess=function(n){return e(n.target.result)},o.onerror=ot(i)}))},query:(n=l,function(e){return new Promise((function(i,o){i=Qe(i);var a=e.trans,u=e.values,s=e.limit,c=e.query,l=s===1/0?void 0:s,f=c.index,h=c.range,d=a.objectStore(t),p=f.isPrimaryKey?d:d.index(f.name),y=r(h);if(0===s)return i({result:[]});if(n){var v=u?p.getAll(y,l):p.getAllKeys(y,l);v.onsuccess=function(e){return i({result:e.target.result})},v.onerror=ot(o)}else{var m=0,g=u||!("openKeyCursor"in p)?p.openCursor(y):p.openKeyCursor(y),b=[];g.onsuccess=function(e){var n=g.result;return n?(b.push(u?n.value:n.primaryKey),++m===s?i({result:b}):void n.continue()):i({result:b})},g.onerror=ot(o)}}))}),openCursor:function(e){var n=e.trans,i=e.values,o=e.query,a=e.reverse,u=e.unique;return new Promise((function(e,s){e=Qe(e);var c=o.index,l=o.range,f=n.objectStore(t),h=c.isPrimaryKey?f:f.index(c.name),d=a?u?"prevunique":"prev":u?"nextunique":"next",p=i||!("openKeyCursor"in h)?h.openCursor(r(l),d):h.openKeyCursor(r(l),d);p.onerror=ot(s),p.onsuccess=Qe((function(t){var r=p.result;if(r){r.___id=++mt,r.done=!1;var i=r.continue.bind(r),o=r.continuePrimaryKey;o&&(o=o.bind(r));var a=r.advance.bind(r),u=function(){throw new Error("Cursor not stopped")};r.trans=n,r.stop=r.continue=r.continuePrimaryKey=r.advance=function(){throw new Error("Cursor not started")},r.fail=Qe(s),r.next=function(){var e=this,n=1;return this.start((function(){return n--?e.continue():e.stop()})).then((function(){return e}))},r.start=function(e){var n=new Promise((function(e,n){e=Qe(e),p.onerror=ot(n),r.fail=n,r.stop=function(n){r.stop=r.continue=r.continuePrimaryKey=r.advance=u,e(n)}})),t=function(){if(p.result)try{e()}catch(n){r.fail(n)}else r.done=!0,r.start=function(){throw new Error("Cursor behind last entry")},r.stop()};return p.onsuccess=Qe((function(e){p.onsuccess=t,t()})),r.continue=i,r.continuePrimaryKey=o,r.advance=a,t(),n},e(r)}else e(null)}),s)}))},count:function(e){var n=e.query,i=e.trans,o=n.index,a=n.range;return new Promise((function(e,n){var u=i.objectStore(t),s=o.isPrimaryKey?u:u.index(o.name),c=r(a),l=c?s.count(c):s.count();l.onsuccess=Qe((function(n){return e(n.target.result)})),l.onerror=ot(n)}))}}}(e)})),h={};return f.forEach((function(e){return h[e.name]=e})),{stack:"dbcore",transaction:e.transaction.bind(e),table:function(e){if(!h[e])throw new Error("Table '"+e+"' not found");return h[e]},MIN_KEY:-1/0,MAX_KEY:pt(n),schema:c}}function _t(n,t,r,i){var o=r.IDBKeyRange;r.indexedDB;var a=function(n,t){return t.reduce((function(n,t){var r=t.create;return e(e({},n),r(n))}),n)}(bt(t,o,i),n.dbcore);return{dbcore:a}}function wt(e,n){var t=e._novip,r=n.db,i=_t(t._middlewares,r,t._deps,n);t.core=i.dbcore,t.tables.forEach((function(e){var n=e.name;t.core.schema.tables.some((function(e){return e.name===n}))&&(e.core=t.core.table(n),t[n]instanceof t.Table&&(t[n].core=e.core))}))}function xt(e,n,t,r){var i=e._novip;t.forEach((function(e){var t=r[e];n.forEach((function(n){var r=p(n,e);(!r||"value"in r&&void 0===r.value)&&(n===i.Transaction.prototype||n instanceof i.Transaction?f(n,e,{get:function(){return this.table(e)},set:function(n){l(this,e,{value:n,writable:!0,configurable:!0,enumerable:!0})}}):n[e]=new i.Table(e,t))}))}))}function kt(e,n){var t=e._novip;n.forEach((function(e){for(var n in e)e[n]instanceof t.Table&&delete e[n]}))}function Et(e,n){return e._cfg.version-n._cfg.version}function Pt(e,n,t,i){var o=e._dbSchema,a=e._createTransaction("readwrite",e._storeNames,o);a.create(t),a._completion.catch(i);var u=a._reject.bind(a),s=Ce.transless||Ce;tn((function(){Ce.trans=a,Ce.transless=s,0===n?(r(o).forEach((function(e){Ot(t,e,o[e].primKey,o[e].indexes)})),wt(e,t),Be.follow((function(){return e.on.populate.fire(a)})).catch(u)):function(e,n,t,i){var o=e._novip,a=[],u=o._versions,s=o._dbSchema=At(o,o.idbdb,i),c=!1,l=u.filter((function(e){return e._cfg.version>=n}));function f(){return a.length?Be.resolve(a.shift()(t.idbtrans)).then(f):Be.resolve()}return l.forEach((function(e){a.push((function(){var a=s,u=e._cfg.dbschema;Ct(o,a,i),Ct(o,u,i),s=o._dbSchema=u;var l=Kt(a,u);l.add.forEach((function(e){Ot(i,e[0],e[1].primKey,e[1].indexes)})),l.change.forEach((function(e){if(e.recreate)throw new Z.Upgrade("Not yet support for changing primary key");var n=i.objectStore(e.name);e.add.forEach((function(e){return St(n,e)})),e.change.forEach((function(e){n.deleteIndex(e.name),St(n,e)})),e.del.forEach((function(e){return n.deleteIndex(e)}))}));var f=e._cfg.contentUpgrade;if(f&&e._cfg.version>n){wt(o,i),t._memoizedTables={},c=!0;var h=k(u);l.del.forEach((function(e){h[e]=a[e]})),kt(o,[o.Transaction.prototype]),xt(o,[o.Transaction.prototype],r(h),h),t.schema=h;var d,p=F(f);p&&rn();var y=Be.follow((function(){if((d=f(t))&&p){var e=on.bind(null,null);d.then(e,e)}}));return d&&"function"==typeof d.then?Be.resolve(d):y.then((function(){return d}))}})),a.push((function(n){c&&Kn||function(e,n){[].slice.call(n.db.objectStoreNames).forEach((function(t){return null==e[t]&&n.db.deleteObjectStore(t)}))}(e._cfg.dbschema,n);kt(o,[o.Transaction.prototype]),xt(o,[o.Transaction.prototype],o._storeNames,o._dbSchema),t.schema=o._dbSchema}))})),f().then((function(){var e,n;n=i,r(e=s).forEach((function(t){n.db.objectStoreNames.contains(t)||Ot(n,t,e[t].primKey,e[t].indexes)}))}))}(e,n,a,t).catch(u)}))}function Kt(e,n){var t,r={del:[],add:[],change:[]};for(t in e)n[t]||r.del.push(t);for(t in n){var i=e[t],o=n[t];if(i){var a={name:t,def:o,recreate:!1,del:[],add:[],change:[]};if(""+(i.primKey.keyPath||"")!=""+(o.primKey.keyPath||"")||i.primKey.auto!==o.primKey.auto&&!Pn)a.recreate=!0,r.change.push(a);else{var u=i.idxByName,s=o.idxByName,c=void 0;for(c in u)s[c]||a.del.push(c);for(c in s){var l=u[c],f=s[c];l?l.src!==f.src&&a.change.push(f):a.add.push(f)}(a.del.length>0||a.add.length>0||a.change.length>0)&&r.change.push(a)}}else r.add.push([t,o])}return r}function Ot(e,n,t,r){var i=e.db.createObjectStore(n,t.keyPath?{keyPath:t.keyPath,autoIncrement:t.auto}:{autoIncrement:t.auto});return r.forEach((function(e){return St(i,e)})),i}function St(e,n){e.createIndex(n.name,n.keyPath,{unique:n.unique,multiEntry:n.multi})}function At(e,n,t){var r={};return v(n.objectStoreNames,0).forEach((function(e){for(var n=t.objectStore(e),i=n.keyPath,o=ft(ht(i),i||"",!1,!1,!!n.autoIncrement,i&&"string"!=typeof i,!0),a=[],u=0;u<n.indexNames.length;++u){var s=n.index(n.indexNames[u]);i=s.keyPath;var c=ft(s.name,i,!!s.unique,!!s.multiEntry,!1,i&&"string"!=typeof i,!1);a.push(c)}r[e]=dt(e,o,a)})),r}function Ct(e,n,r){for(var i=e._novip,o=r.db.objectStoreNames,a=0;a<o.length;++a){var u=o[a],s=r.objectStore(u);i._hasGetAll="getAll"in s;for(var c=0;c<s.indexNames.length;++c){var l=s.indexNames[c],f=s.index(l).keyPath,h="string"==typeof f?f:"["+v(f).join("+")+"]";if(n[u]){var d=n[u].idxByName[h];d&&(d.name=l,delete n[u].idxByName[h],n[u].idxByName[l]=d)}}}"undefined"!=typeof navigator&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&t.WorkerGlobalScope&&t instanceof t.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(i._hasGetAll=!1)}var jt=function(){function e(){}return e.prototype._parseStoresSpec=function(e,n){r(e).forEach((function(t){if(null!==e[t]){var r=e[t].split(",").map((function(e,n){var t=(e=e.trim()).replace(/([&*]|\+\+)/g,""),r=/^\[/.test(t)?t.match(/^\[(.*)\]$/)[1].split("+"):t;return ft(t,r||null,/\&/.test(e),/\*/.test(e),/\+\+/.test(e),i(r),0===n)})),o=r.shift();if(o.multi)throw new Z.Schema("Primary key cannot be multi-valued");r.forEach((function(e){if(e.auto)throw new Z.Schema("Only primary key can be marked as autoIncrement (++)");if(!e.keyPath)throw new Z.Schema("Index must have a name and cannot be an empty string")})),n[t]=dt(t,o,r)}}))},e.prototype.stores=function(e){var n=this.db;this._cfg.storesSource=this._cfg.storesSource?o(this._cfg.storesSource,e):e;var t=n._versions,i={},a={};return t.forEach((function(e){o(i,e._cfg.storesSource),a=e._cfg.dbschema={},e._parseStoresSpec(i,a)})),n._dbSchema=a,kt(n,[n._allTables,n,n.Transaction.prototype]),xt(n,[n._allTables,n,n.Transaction.prototype,this._cfg.tables],r(a),a),n._storeNames=r(a),this},e.prototype.upgrade=function(e){return this._cfg.contentUpgrade=le(this._cfg.contentUpgrade||te,e),this},e}();function Dt(e,n){var t=e._dbNamesDB;return t||(t=e._dbNamesDB=new nr(An,{addons:[],indexedDB:e,IDBKeyRange:n})).version(1).stores({dbnames:"name"}),t.table("dbnames")}function It(e){return e&&"function"==typeof e.databases}function Bt(e){return tn((function(){return Ce.letThrough=!0,e()}))}function Tt(e){var n=e._state,t=e._deps.indexedDB;if(n.isBeingOpened||e.idbdb)return n.dbReadyPromise.then((function(){return n.dbOpenError?mn(n.dbOpenError):e}));M&&(n.openCanceller._stackHolder=L()),n.isBeingOpened=!0,n.dbOpenError=null,n.openComplete=!1;var i=n.openCanceller;function o(){if(n.openCanceller!==i)throw new Z.DatabaseClosed("db.open() was cancelled")}var a,u=n.dbReadyResolve,s=null,c=!1;return Be.race([i,("undefined"==typeof navigator?Be.resolve():!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent)&&indexedDB.databases?new Promise((function(e){var n=function(){return indexedDB.databases().finally(e)};a=setInterval(n,100),n()})).finally((function(){return clearInterval(a)})):Promise.resolve()).then((function(){return new Be((function(i,a){if(o(),!t)throw new Z.MissingAPI;var u=e.name,l=n.autoSchema?t.open(u):t.open(u,Math.round(10*e.verno));if(!l)throw new Z.MissingAPI;l.onerror=ot(a),l.onblocked=Qe(e._fireOnBlocked),l.onupgradeneeded=Qe((function(r){if(s=l.transaction,n.autoSchema&&!e._options.allowEmptyDB){l.onerror=at,s.abort(),l.result.close();var i=t.deleteDatabase(u);i.onsuccess=i.onerror=Qe((function(){a(new Z.NoSuchDatabase("Database "+u+" doesnt exist"))}))}else{s.onerror=ot(a);var o=r.oldVersion>Math.pow(2,62)?0:r.oldVersion;c=o<1,e._novip.idbdb=l.result,Pt(e,o/10,s,a)}}),a),l.onsuccess=Qe((function(){s=null;var t,o=e._novip.idbdb=l.result,a=v(o.objectStoreNames);if(a.length>0)try{var f=o.transaction(1===(t=a).length?t[0]:t,"readonly");n.autoSchema?function(e,n,t){var i=e._novip;i.verno=n.version/10;var o=i._dbSchema=At(0,n,t);i._storeNames=v(n.objectStoreNames,0),xt(i,[i._allTables],r(o),o)}(e,o,f):(Ct(e,e._dbSchema,f),function(e,n){var t=Kt(At(0,e.idbdb,n),e._dbSchema);return!(t.add.length||t.change.some((function(e){return e.add.length||e.change.length})))}(e,f)||console.warn("Dexie SchemaDiff: Schema was extended without increasing the number passed to db.version(). Some queries may fail.")),wt(e,f)}catch(h){}En.push(e),o.onversionchange=Qe((function(t){n.vcFired=!0,e.on("versionchange").fire(t)})),o.onclose=Qe((function(n){e.on("close").fire(n)})),c&&function(e,n){var t=e.indexedDB,r=e.IDBKeyRange;!It(t)&&n!==An&&Dt(t,r).put({name:n}).catch(te)}(e._deps,u),i()}),a)}))}))]).then((function(){return o(),n.onReadyBeingFired=[],Be.resolve(Bt((function(){return e.on.ready.fire(e.vip)}))).then((function t(){if(n.onReadyBeingFired.length>0){var r=n.onReadyBeingFired.reduce(le,te);return n.onReadyBeingFired=[],Be.resolve(Bt((function(){return r(e.vip)}))).then(t)}}))})).finally((function(){n.onReadyBeingFired=null,n.isBeingOpened=!1})).then((function(){return e})).catch((function(t){n.dbOpenError=t;try{s&&s.abort()}catch(r){}return i===n.openCanceller&&e._close(),mn(t)})).finally((function(){n.openComplete=!0,u()}))}function Rt(e){var n=function(n){return e.next(n)},t=o(n),r=o((function(n){return e.throw(n)}));function o(e){return function(n){var o=e(n),a=o.value;return o.done?a:a&&"function"==typeof a.then?a.then(t,r):i(a)?Promise.all(a).then(t,r):t(a)}}return o(n)()}function Ft(e,n,t){var r=arguments.length;if(r<2)throw new Z.InvalidArgument("Too few arguments");for(var i=new Array(r-1);--r;)i[r-1]=arguments[r];return t=i.pop(),[e,P(i),t]}function Mt(e,n,t,r,i){return Be.resolve().then((function(){var o=Ce.transless||Ce,a=e._createTransaction(n,t,e._dbSchema,r),u={trans:a,transless:o};if(r)a.idbtrans=r.idbtrans;else try{a.create(),e._state.PR1398_maxLoop=3}catch(f){return f.name===J.InvalidState&&e.isOpen()&&--e._state.PR1398_maxLoop>0?(console.warn("Dexie: Need to reopen db"),e._close(),e.open().then((function(){return Mt(e,n,t,null,i)}))):mn(f)}var s,c=F(i);c&&rn();var l=Be.follow((function(){if(s=i.call(a,a))if(c){var e=on.bind(null,null);s.then(e,e)}else"function"==typeof s.next&&"function"==typeof s.throw&&(s=Rt(s))}),u);return(s&&"function"==typeof s.then?Be.resolve(s).then((function(e){return a.active?e:mn(new Z.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn"))})):l.then((function(){return s}))).then((function(e){return r&&a._resolve(),a._completion.then((function(){return e}))})).catch((function(e){return a._reject(e),mn(e)}))}))}function Nt(e,n,t){for(var r=i(e)?e.slice():[e],o=0;o<t;++o)r.push(n);return r}var qt={stack:"dbcore",name:"VirtualIndexMiddleware",level:1,create:function(n){return e(e({},n),{table:function(t){var r=n.table(t),i=r.schema,o={},a=[];function u(n,t,r){var i=gt(n),s=o[i]=o[i]||[],c=null==n?0:"string"==typeof n?1:n.length,l=t>0,f=e(e({},r),{isVirtual:l,keyTail:t,keyLength:c,extractKey:yt(n),unique:!l&&r.unique});(s.push(f),f.isPrimaryKey||a.push(f),c>1)&&u(2===c?n[0]:n.slice(0,c-1),t+1,r);return s.sort((function(e,n){return e.keyTail-n.keyTail})),f}var s=u(i.primaryKey.keyPath,0,i.primaryKey);o[":id"]=[s];for(var c=0,l=i.indexes;c<l.length;c++){var f=l[c];u(f.keyPath,0,f)}function h(t){var r,i,o=t.query.index;return o.isVirtual?e(e({},t),{query:{index:o,range:(r=t.query.range,i=o.keyTail,{type:1===r.type?2:r.type,lower:Nt(r.lower,r.lowerOpen?n.MAX_KEY:n.MIN_KEY,i),lowerOpen:!0,upper:Nt(r.upper,r.upperOpen?n.MIN_KEY:n.MAX_KEY,i),upperOpen:!0})}}):t}return e(e({},r),{schema:e(e({},i),{primaryKey:s,indexes:a,getIndexByKeyPath:function(e){var n=o[gt(e)];return n&&n[0]}}),count:function(e){return r.count(h(e))},query:function(e){return r.query(h(e))},openCursor:function(e){var t=e.query.index,i=t.keyTail,o=t.isVirtual,a=t.keyLength;if(!o)return r.openCursor(e);return r.openCursor(h(e)).then((function(t){return t&&function(t){return Object.create(t,{continue:{value:function(r){null!=r?t.continue(Nt(r,e.reverse?n.MAX_KEY:n.MIN_KEY,i)):e.unique?t.continue(t.key.slice(0,a).concat(e.reverse?n.MIN_KEY:n.MAX_KEY,i)):t.continue()}},continuePrimaryKey:{value:function(e,r){t.continuePrimaryKey(Nt(e,n.MAX_KEY,i),r)}},primaryKey:{get:function(){return t.primaryKey}},key:{get:function(){var e=t.key;return 1===a?e[0]:e.slice(0,a)}},value:{get:function(){return t.value}}})}(t)}))}})}})}};function Ut(e,n,t,i){return t=t||{},i=i||"",r(e).forEach((function(r){if(s(n,r)){var o=e[r],a=n[r];if("object"==typeof o&&"object"==typeof a&&o&&a){var u=D(o);u!==D(a)?t[i+r]=n[r]:"Object"===u?Ut(o,a,t,i+r+"."):o!==a&&(t[i+r]=n[r])}else o!==a&&(t[i+r]=n[r])}else t[i+r]=void 0})),r(n).forEach((function(r){s(e,r)||(t[i+r]=n[r])})),t}var Lt={stack:"dbcore",name:"HooksMiddleware",level:2,create:function(t){return e(e({},t),{table:function(r){var i=t.table(r),o=i.schema.primaryKey;return e(e({},i),{mutate:function(t){var a=Ce.trans,u=a.table(r).hook,c=u.deleting,l=u.creating,f=u.updating;switch(t.type){case"add":if(l.fire===te)break;return a._promise("readwrite",(function(){return h(t)}),!0);case"put":if(l.fire===te&&f.fire===te)break;return a._promise("readwrite",(function(){return h(t)}),!0);case"delete":if(c.fire===te)break;return a._promise("readwrite",(function(){return h(t)}),!0);case"deleteRange":if(c.fire===te)break;return a._promise("readwrite",(function(){return d((e=t).trans,e.range,1e4);var e}),!0)}return i.mutate(t);function h(t){var r=Ce.trans,a=t.keys||function(e,n){return"delete"===n.type?n.keys:n.keys||n.values.map(e.extractKey)}(o,t);if(!a)throw new Error("Keys missing");return"delete"!==(t="add"===t.type||"put"===t.type?e(e({},t),{keys:a}):e({},t)).type&&(t.values=n([],t.values,!0)),t.keys&&(t.keys=n([],t.keys,!0)),function(e,n,t){return"add"===n.type?Promise.resolve([]):e.getMany({trans:n.trans,keys:t,cache:"immutable"})}(i,t,a).then((function(e){var n=a.map((function(n,i){var a=e[i],u={onerror:null,onsuccess:null};if("delete"===t.type)c.fire.call(u,n,a,r);else if("add"===t.type||void 0===a){var h=l.fire.call(u,n,t.values[i],r);null==n&&null!=h&&(n=h,t.keys[i]=n,o.outbound||x(t.values[i],o.keyPath,n))}else{var d=Ut(a,t.values[i]),p=f.fire.call(u,d,n,a,r);if(p){var y=t.values[i];Object.keys(p).forEach((function(e){s(y,e)?y[e]=p[e]:x(y,e,p[e])}))}}return u}));return i.mutate(t).then((function(r){for(var i=r.failures,o=r.results,u=r.numFailures,s=r.lastResult,c=0;c<a.length;++c){var l=o?o[c]:a[c],f=n[c];null==l?f.onerror&&f.onerror(i[c]):f.onsuccess&&f.onsuccess("put"===t.type&&e[c]?t.values[c]:l)}return{failures:i,results:o,numFailures:u,lastResult:s}})).catch((function(e){return n.forEach((function(n){return n.onerror&&n.onerror(e)})),Promise.reject(e)}))}))}function d(n,t,r){return i.query({trans:n,values:!1,query:{index:o,range:t},limit:r}).then((function(i){var o=i.result;return h({type:"delete",keys:o,trans:n}).then((function(i){return i.numFailures>0?Promise.reject(i.failures[0]):o.length<r?{failures:[],numFailures:0,lastResult:void 0}:d(n,e(e({},t),{lower:o[o.length-1],lowerOpen:!0}),r)}))}))}}})}})}};function Vt(e,n,t){try{if(!n)return null;if(n.keys.length<e.length)return null;for(var r=[],i=0,o=0;i<n.keys.length&&o<e.length;++i)0===Yn(n.keys[i],e[o])&&(r.push(t?A(n.values[i]):n.values[i]),++o);return r.length===e.length?r:null}catch(a){return null}}var Wt,Yt={stack:"dbcore",level:-1,create:function(n){return{table:function(t){var r=n.table(t);return e(e({},r),{getMany:function(e){if(!e.cache)return r.getMany(e);var n=Vt(e.keys,e.trans._cache,"clone"===e.cache);return n?Be.resolve(n):r.getMany(e).then((function(n){return e.trans._cache={keys:e.keys,values:"clone"===e.cache?A(n):n},n}))},mutate:function(e){return"add"!==e.type&&(e.trans._cache=null),r.mutate(e)}})}}}};function zt(e){return!("from"in e)}var Gt=function(e,n){if(!this){var t=new Gt;return e&&"d"in e&&o(t,e),t}o(this,arguments.length?{d:1,from:e,to:arguments.length>1?n:e}:{d:0})};function Ht(e,n,t){var r=Yn(n,t);if(!isNaN(r)){if(r>0)throw RangeError();if(zt(e))return o(e,{from:n,to:t,d:1});var i=e.l,a=e.r;if(Yn(t,e.from)<0)return i?Ht(i,n,t):e.l={from:n,to:t,d:1,l:null,r:null},Jt(e);if(Yn(n,e.to)>0)return a?Ht(a,n,t):e.r={from:n,to:t,d:1,l:null,r:null},Jt(e);Yn(n,e.from)<0&&(e.from=n,e.l=null,e.d=a?a.d+1:1),Yn(t,e.to)>0&&(e.to=t,e.r=null,e.d=e.l?e.l.d+1:1);var u=!e.r;i&&!e.l&&Qt(e,i),a&&u&&Qt(e,a)}}function Qt(e,n){zt(n)||function e(n,t){var r=t.from,i=t.to,o=t.l,a=t.r;Ht(n,r,i),o&&e(n,o),a&&e(n,a)}(e,n)}function Xt(e){var n=zt(e)?null:{s:0,n:e};return{next:function(e){for(var t=arguments.length>0;n;)switch(n.s){case 0:if(n.s=1,t)for(;n.n.l&&Yn(e,n.n.from)<0;)n={up:n,n:n.n.l,s:1};else for(;n.n.l;)n={up:n,n:n.n.l,s:1};case 1:if(n.s=2,!t||Yn(e,n.n.to)<=0)return{value:n.n,done:!1};case 2:if(n.n.r){n.s=3,n={up:n,n:n.n.r,s:0};continue}case 3:n=n.up}return{done:!0}}}}function Jt(n){var t,r,i=((null===(t=n.r)||void 0===t?void 0:t.d)||0)-((null===(r=n.l)||void 0===r?void 0:r.d)||0),o=i>1?"r":i<-1?"l":"";if(o){var a="r"===o?"l":"r",u=e({},n),s=n[o];n.from=s.from,n.to=s.to,n[o]=s[o],u[o]=s[a],n[a]=u,u.d=$t(u)}n.d=$t(n)}function $t(e){var n=e.r,t=e.l;return(n?t?Math.max(n.d,t.d):n.d:t?t.d:0)+1}c(Gt.prototype,((Wt={add:function(e){return Qt(this,e),this},addKey:function(e){return Ht(this,e,e),this},addKeys:function(e){var n=this;return e.forEach((function(e){return Ht(n,e,e)})),this}})[I]=function(){return Xt(this)},Wt));var Zt={stack:"dbcore",level:0,create:function(n){var t=n.schema.name,o=new Gt(n.MIN_KEY,n.MAX_KEY);return e(e({},n),{table:function(a){var u=n.table(a),s=u.schema,c=s.primaryKey,l=c.extractKey,f=c.outbound,h=e(e({},u),{mutate:function(e){var n=e.trans,r=n.mutatedParts||(n.mutatedParts={}),c=function(e){var n="idb://"+t+"/"+a+"/"+e;return r[n]||(r[n]=new Gt)},l=c(""),f=c(":dels"),h=e.type,d="deleteRange"===e.type?[e.range]:"delete"===e.type?[e.keys]:e.values.length<50?[[],e.values]:[],p=d[0],y=d[1],v=e.trans._cache;return u.mutate(e).then((function(e){if(i(p)){"delete"!==h&&(p=e.results),l.addKeys(p);var n=Vt(p,v);n||"add"===h||f.addKeys(p),(n||y)&&function(e,n,t,r){function o(n){var o=e(n.name||"");function a(e){return null!=e?n.extractKey(e):null}var u=function(e){return n.multiEntry&&i(e)?e.forEach((function(e){return o.addKey(e)})):o.addKey(e)};(t||r).forEach((function(e,n){var i=t&&a(t[n]),o=r&&a(r[n]);0!==Yn(i,o)&&(null!=i&&u(i),null!=o&&u(o))}))}n.indexes.forEach(o)}(c,s,n,y)}else if(p){var t={from:p.lower,to:p.upper};f.add(t),l.add(t)}else l.add(o),f.add(o),s.indexes.forEach((function(e){return c(e.name).add(o)}));return e}))}}),d=function(e){var t,r,i=e.query,o=i.index,a=i.range;return[o,new Gt(null!==(t=a.lower)&&void 0!==t?t:n.MIN_KEY,null!==(r=a.upper)&&void 0!==r?r:n.MAX_KEY)]},p={get:function(e){return[c,new Gt(e.key)]},getMany:function(e){return[c,(new Gt).addKeys(e.keys)]},count:d,query:d,openCursor:d};return r(p).forEach((function(n){h[n]=function(r){var i=Ce.subscr;if(i){var s=function(e){var n="idb://"+t+"/"+a+"/"+e;return i[n]||(i[n]=new Gt)},c=s(""),h=s(":dels"),d=p[n](r),y=d[0],v=d[1];if(s(y.name||"").add(v),!y.isPrimaryKey){if("count"!==n){var m="query"===n&&f&&r.values&&u.query(e(e({},r),{values:!1}));return u[n].apply(this,arguments).then((function(e){if("query"===n){if(f&&r.values)return m.then((function(n){var t=n.result;return c.addKeys(t),e}));var t=r.values?e.result.map(l):e.result;r.values?c.addKeys(t):h.addKeys(t)}else if("openCursor"===n){var i=e,o=r.values;return i&&Object.create(i,{key:{get:function(){return h.addKey(i.primaryKey),i.key}},primaryKey:{get:function(){var e=i.primaryKey;return h.addKey(e),e}},value:{get:function(){return o&&c.addKey(i.primaryKey),i.value}}})}return e}))}h.add(o)}}return u[n].apply(this,arguments)}})),h}})}};var er,nr=function(){function n(t,r){var i=this;this._middlewares={},this.verno=0;var o=n.dependencies;this._options=r=e({addons:n.addons,autoOpen:!0,indexedDB:o.indexedDB,IDBKeyRange:o.IDBKeyRange},r),this._deps={indexedDB:r.indexedDB,IDBKeyRange:r.IDBKeyRange};var a=r.addons;this._dbSchema={},this._versions=[],this._storeNames=[],this._allTables={},this.idbdb=null,this._novip=this;var u,s={dbOpenError:null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:te,dbReadyPromise:null,cancelOpen:te,openCanceller:null,autoSchema:!0,PR1398_maxLoop:3};s.dbReadyPromise=new Be((function(e){s.dbReadyResolve=e})),s.openCanceller=new Be((function(e,n){s.cancelOpen=n})),this._state=s,this.name=t,this.on=Rn(this,"populate","blocked","versionchange","close",{ready:[le,te]}),this.on.ready.subscribe=m(this.on.ready.subscribe,(function(e){return function(t,r){n.vip((function(){var n=i._state;if(n.openComplete)n.dbOpenError||Be.resolve().then(t),r&&e(t);else if(n.onReadyBeingFired)n.onReadyBeingFired.push(t),r&&e(t);else{e(t);var o=i;r||e((function e(){o.on.ready.unsubscribe(t),o.on.ready.unsubscribe(e)}))}}))}})),this.Collection=(u=this,Fn(Hn.prototype,(function(e,n){this.db=u;var t=In,r=null;if(n)try{t=n()}catch(s){r=s}var i=e._ctx,o=i.table,a=o.hook.reading.fire;this._ctx={table:o,index:i.index,isPrimKey:!i.index||o.schema.primKey.keyPath&&i.index===o.schema.primKey.name,range:t,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:r,or:i.or,valueMapper:a!==re?a:null}}))),this.Table=function(e){return Fn(Tn.prototype,(function(n,t,r){this.db=e,this._tx=r,this.name=n,this.schema=t,this.hook=e._allTables[n]?e._allTables[n].hook:Rn(null,{creating:[ae,te],reading:[ie,re],updating:[se,te],deleting:[ue,te]})}))}(this),this.Transaction=function(e){return Fn(lt.prototype,(function(n,t,r,i,o){var a=this;this.db=e,this.mode=n,this.storeNames=t,this.schema=r,this.chromeTransactionDurability=i,this.idbtrans=null,this.on=Rn(this,"complete","error","abort"),this.parent=o||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new Be((function(e,n){a._resolve=e,a._reject=n})),this._completion.then((function(){a.active=!1,a.on.complete.fire()}),(function(e){var n=a.active;return a.active=!1,a.on.error.fire(e),a.parent?a.parent._reject(e):n&&a.idbtrans&&a.idbtrans.abort(),mn(e)}))}))}(this),this.Version=function(e){return Fn(jt.prototype,(function(n){this.db=e,this._cfg={version:n,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}}))}(this),this.WhereClause=function(e){return Fn(it.prototype,(function(n,t,r){this.db=e,this._ctx={table:n,index:":id"===t?null:t,or:r};var i=e._deps.indexedDB;if(!i)throw new Z.MissingAPI;this._cmp=this._ascending=i.cmp.bind(i),this._descending=function(e,n){return i.cmp(n,e)},this._max=function(e,n){return i.cmp(e,n)>0?e:n},this._min=function(e,n){return i.cmp(e,n)<0?e:n},this._IDBKeyRange=e._deps.IDBKeyRange}))}(this),this.on("versionchange",(function(e){e.newVersion>0?console.warn("Another connection wants to upgrade database '"+i.name+"'. Closing db now to resume the upgrade."):console.warn("Another connection wants to delete database '"+i.name+"'. Closing db now to resume the delete request."),i.close()})),this.on("blocked",(function(e){!e.newVersion||e.newVersion<e.oldVersion?console.warn("Dexie.delete('"+i.name+"') was blocked"):console.warn("Upgrade '"+i.name+"' blocked by other connection holding version "+e.oldVersion/10)})),this._maxKey=pt(r.IDBKeyRange),this._createTransaction=function(e,n,t,r){return new i.Transaction(e,n,t,i._options.chromeTransactionDurability,r)},this._fireOnBlocked=function(e){i.on("blocked").fire(e),En.filter((function(e){return e.name===i.name&&e!==i&&!e._state.vcFired})).map((function(n){return n.on("versionchange").fire(e)}))},this.use(qt),this.use(Lt),this.use(Zt),this.use(Yt),this.vip=Object.create(this,{_vip:{value:!0}}),a.forEach((function(e){return e(i)}))}return n.prototype.version=function(e){if(isNaN(e)||e<.1)throw new Z.Type("Given version is not a positive number");if(e=Math.round(10*e)/10,this.idbdb||this._state.isBeingOpened)throw new Z.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,e);var n=this._versions,t=n.filter((function(n){return n._cfg.version===e}))[0];return t||(t=new this.Version(e),n.push(t),n.sort(Et),t.stores({}),this._state.autoSchema=!1,t)},n.prototype._whenReady=function(e){var n=this;return this.idbdb&&(this._state.openComplete||Ce.letThrough||this._vip)?e():new Be((function(e,t){if(n._state.openComplete)return t(new Z.DatabaseClosed(n._state.dbOpenError));if(!n._state.isBeingOpened){if(!n._options.autoOpen)return void t(new Z.DatabaseClosed);n.open().catch(te)}n._state.dbReadyPromise.then(e,t)})).then(e)},n.prototype.use=function(e){var n=e.stack,t=e.create,r=e.level,i=e.name;i&&this.unuse({stack:n,name:i});var o=this._middlewares[n]||(this._middlewares[n]=[]);return o.push({stack:n,create:t,level:null==r?10:r,name:i}),o.sort((function(e,n){return e.level-n.level})),this},n.prototype.unuse=function(e){var n=e.stack,t=e.name,r=e.create;return n&&this._middlewares[n]&&(this._middlewares[n]=this._middlewares[n].filter((function(e){return r?e.create!==r:!!t&&e.name!==t}))),this},n.prototype.open=function(){return Tt(this)},n.prototype._close=function(){var e=this._state,n=En.indexOf(this);if(n>=0&&En.splice(n,1),this.idbdb){try{this.idbdb.close()}catch(t){}this._novip.idbdb=null}e.dbReadyPromise=new Be((function(n){e.dbReadyResolve=n})),e.openCanceller=new Be((function(n,t){e.cancelOpen=t}))},n.prototype.close=function(){this._close();var e=this._state;this._options.autoOpen=!1,e.dbOpenError=new Z.DatabaseClosed,e.isBeingOpened&&e.cancelOpen(e.dbOpenError)},n.prototype.delete=function(){var e=this,n=arguments.length>0,t=this._state;return new Be((function(r,i){var o=function(){e.close();var n=e._deps.indexedDB.deleteDatabase(e.name);n.onsuccess=Qe((function(){var n,t,i,o;n=e._deps,t=e.name,i=n.indexedDB,o=n.IDBKeyRange,!It(i)&&t!==An&&Dt(i,o).delete(t).catch(te),r()})),n.onerror=ot(i),n.onblocked=e._fireOnBlocked};if(n)throw new Z.InvalidArgument("Arguments not allowed in db.delete()");t.isBeingOpened?t.dbReadyPromise.then(o):o()}))},n.prototype.backendDB=function(){return this.idbdb},n.prototype.isOpen=function(){return null!==this.idbdb},n.prototype.hasBeenClosed=function(){var e=this._state.dbOpenError;return e&&"DatabaseClosed"===e.name},n.prototype.hasFailed=function(){return null!==this._state.dbOpenError},n.prototype.dynamicallyOpened=function(){return this._state.autoSchema},Object.defineProperty(n.prototype,"tables",{get:function(){var e=this;return r(this._allTables).map((function(n){return e._allTables[n]}))},enumerable:!1,configurable:!0}),n.prototype.transaction=function(){var e=Ft.apply(this,arguments);return this._transaction.apply(this,e)},n.prototype._transaction=function(e,n,t){var r=this,i=Ce.trans;i&&i.db===this&&-1===e.indexOf("!")||(i=null);var o,a,u=-1!==e.indexOf("?");e=e.replace("!","").replace("?","");try{if(a=n.map((function(e){var n=e instanceof r.Table?e.name:e;if("string"!=typeof n)throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return n})),"r"==e||e===Cn)o=Cn;else{if("rw"!=e&&e!=jn)throw new Z.InvalidArgument("Invalid transaction mode: "+e);o=jn}if(i){if(i.mode===Cn&&o===jn){if(!u)throw new Z.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");i=null}i&&a.forEach((function(e){if(i&&-1===i.storeNames.indexOf(e)){if(!u)throw new Z.SubTransaction("Table "+e+" not included in parent transaction.");i=null}})),u&&i&&!i.active&&(i=null)}}catch(c){return i?i._promise(null,(function(e,n){n(c)})):mn(c)}var s=Mt.bind(null,this,o,a,i,t);return i?i._promise(o,s,"lock"):Ce.trans?fn(Ce.transless,(function(){return r._whenReady(s)})):this._whenReady(s)},n.prototype.table=function(e){if(!s(this._allTables,e))throw new Z.InvalidTable("Table "+e+" does not exist");return this._allTables[e]},n}(),tr="undefined"!=typeof Symbol&&"observable"in Symbol?Symbol.observable:"@@observable",rr=function(){function e(e){this._subscribe=e}return e.prototype.subscribe=function(e,n,t){return this._subscribe(e&&"function"!=typeof e?e:{next:e,error:n,complete:t})},e.prototype[tr]=function(){return this},e}();function ir(e,n){return r(n).forEach((function(t){Qt(e[t]||(e[t]=new Gt),n[t])})),e}try{er={indexedDB:t.indexedDB||t.mozIndexedDB||t.webkitIndexedDB||t.msIndexedDB,IDBKeyRange:t.IDBKeyRange||t.webkitIDBKeyRange}}catch(fr){er={indexedDB:null,IDBKeyRange:null}}var or=nr;function ar(e){var n=ur;try{ur=!0,ct.storagemutated.fire(e)}finally{ur=n}}c(or,e(e({},ne),{delete:function(e){return new or(e,{addons:[]}).delete()},exists:function(e){return new or(e,{addons:[]}).open().then((function(e){return e.close(),!0})).catch("NoSuchDatabaseError",(function(){return!1}))},getDatabaseNames:function(e){try{return(n=or.dependencies,t=n.indexedDB,r=n.IDBKeyRange,It(t)?Promise.resolve(t.databases()).then((function(e){return e.map((function(e){return e.name})).filter((function(e){return e!==An}))})):Dt(t,r).toCollection().primaryKeys()).then(e)}catch(n){return mn(new Z.MissingAPI)}var n,t,r},defineClass:function(){return function(e){o(this,e)}},ignoreTransaction:function(e){return Ce.trans?fn(Ce.transless,e):e()},vip:Bt,async:function(e){return function(){try{var n=Rt(e.apply(this,arguments));return n&&"function"==typeof n.then?n:Be.resolve(n)}catch(fr){return mn(fr)}}},spawn:function(e,n,t){try{var r=Rt(e.apply(t,n||[]));return r&&"function"==typeof r.then?r:Be.resolve(r)}catch(fr){return mn(fr)}},currentTransaction:{get:function(){return Ce.trans||null}},waitFor:function(e,n){var t=Be.resolve("function"==typeof e?or.ignoreTransaction(e):e).timeout(n||6e4);return Ce.trans?Ce.trans.waitFor(t):t},Promise:Be,debug:{get:function(){return M},set:function(e){N(e,"dexie"===e?function(){return!0}:Sn)}},derive:h,extend:o,props:c,override:m,Events:Rn,on:ct,liveQuery:function(e){var n=!1,t=void 0,i=new rr((function(i){var o=F(e);var a=!1,u={},s={},c={get closed(){return a},unsubscribe:function(){a=!0,ct.storagemutated.unsubscribe(d)}};i.start&&i.start(c);var l=!1,f=!1;function h(){return r(s).some((function(e){return u[e]&&function(e,n){var t=Xt(n),r=t.next();if(r.done)return!1;for(var i=r.value,o=Xt(e),a=o.next(i.from),u=a.value;!r.done&&!a.done;){if(Yn(u.from,i.to)<=0&&Yn(u.to,i.from)>=0)return!0;Yn(i.from,u.from)<0?i=(r=t.next(u.from)).value:u=(a=o.next(i.from)).value}return!1}(u[e],s[e])}))}var d=function(e){ir(u,e),h()&&p()},p=function(){if(!l&&!a){u={};var r={},y=function(n){o&&rn();var t=function(){return tn(e,{subscr:n,trans:null})},r=Ce.trans?fn(Ce.transless,t):t();return o&&r.then(on,on),r}(r);f||(ct(ut,d),f=!0),l=!0,Promise.resolve(y).then((function(e){n=!0,t=e,l=!1,a||(h()?p():(u={},s=r,i.next&&i.next(e)))}),(function(e){l=!1,n=!1,i.error&&i.error(e),c.unsubscribe()}))}};return p(),c}));return i.hasValue=function(){return n},i.getValue=function(){return t},i},extendObservabilitySet:ir,getByKeyPath:w,setByKeyPath:x,delByKeyPath:function(e,n){"string"==typeof n?x(e,n,void 0):"length"in n&&[].map.call(n,(function(n){x(e,n,void 0)}))},shallowClone:k,deepClone:A,getObjectDiff:Ut,cmp:Yn,asap:b,minKey:wn,addons:[],connections:En,errnames:J,dependencies:er,semVer:bn,version:bn.split(".").map((function(e){return parseInt(e)})).reduce((function(e,n,t){return e+n/Math.pow(10,2*t)}))})),or.maxKey=pt(or.dependencies.IDBKeyRange),"undefined"!=typeof dispatchEvent&&"undefined"!=typeof addEventListener&&(ct(ut,(function(e){var n;ur||(Pn?(n=document.createEvent("CustomEvent")).initCustomEvent(st,!0,!0,e):n=new CustomEvent(st,{detail:e}),ur=!0,dispatchEvent(n),ur=!1)})),addEventListener(st,(function(e){var n=e.detail;ur||ar(n)})));var ur=!1;if("undefined"!=typeof BroadcastChannel){var sr=new BroadcastChannel(st);"function"==typeof sr.unref&&sr.unref(),ct(ut,(function(e){ur||sr.postMessage(e)})),sr.onmessage=function(e){e.data&&ar(e.data)}}else if("undefined"!=typeof self&&"undefined"!=typeof navigator){ct(ut,(function(e){try{ur||("undefined"!=typeof localStorage&&localStorage.setItem(st,JSON.stringify({trig:Math.random(),changedParts:e})),"object"==typeof self.clients&&n([],self.clients.matchAll({includeUncontrolled:!0}),!0).forEach((function(n){return n.postMessage({type:st,changedParts:e})})))}catch(t){}})),"undefined"!=typeof addEventListener&&addEventListener("storage",(function(e){if(e.key===st){var n=JSON.parse(e.newValue);n&&ar(n.changedParts)}}));var cr=self.document&&navigator.serviceWorker;cr&&cr.addEventListener("message",(function(e){var n=e.data;n&&n.type===st&&ar(n.changedParts)}))}Be.rejectionMapper=function(e,n){if(!e||e instanceof G||e instanceof TypeError||e instanceof SyntaxError||!e.name||!ee[e.name])return e;var t=new ee[e.name](n||e.message,e);return"stack"in e&&f(t,"stack",{get:function(){return this.inner.stack}}),t},N(M,Sn);const lr=new nr("word-memo");lr.version(2).stores({saved:"++id, &word,bookid, means, ts, lang",record:"++id, book, process, index, count, ts, date",root:"++id, tag, root, ras_indicate, ras_content, parts"});export{lr as d};
